<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>三角函数</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="../../css/note.css" />
</head>
<body>

<h2>特殊角</h2>

<table>
	<tr>
		<td>`theta`</td>
		<td>`sin theta`</td>
		<td>`cos theta`</td>
		<td>`tan theta`</td>
	</tr>
	<tr>
		<td>`n xx 180^@ = n pi`</td>
		<td>`0`</td>
		<td>`(-1)^n`</td>
		<td>`0`</td>
	</tr>
	<tr>
		<td>`90^@ = pi/2 +- 0`</td>
		<td>`1`</td>
		<td>`0`</td>
		<td>`&mp; oo`</td>
	</tr>
	<tr>
		<td>`60^@ = pi/3`</td>
		<td>`(sqrt 3)/2`</td>
		<td>`1/2`</td>
		<td>`sqrt 3`</td>
	</tr>
	<tr>
		<td>`45^@ = pi/4`</td>
		<td>`(sqrt 2)/2`</td>
		<td>`(sqrt 2)/2`</td>
		<td>`1`</td>
	</tr>
	<tr>
		<td>`36^@ = pi/5`</td>
		<td>`sqrt(10-2sqrt 5)/4`</td>
		<td>`(sqrt 5+1)/4`</td>
		<td>`sqrt(5-2sqrt 5)`</td>
	</tr>
	<tr>
		<td>`30^@ = pi/6`</td>
		<td>`1/2`</td>
		<td>`(sqrt 3)/2`</td>
		<td>`(sqrt 3)/3`</td>
	</tr>
	<tr>
		<td>`22.5^@ = pi/8`</td>
		<td>`sqrt(2-sqrt 2)/2`</td>
		<td>`sqrt(2+sqrt 2)/2`</td>
		<td>`sqrt 2 - 1`</td>
	</tr>
	<tr>
		<td>`18^@ = pi/10`</td>
		<td>`(sqrt 5-1)/4`</td>
		<td>`sqrt(10+2sqrt 5)/4`</td>
		<td>`1/sqrt(5+2sqrt 5)`</td>
	</tr>
	<tr>
		<td>`15^@ = pi/12`</td>
		<td>`(sqrt 6-sqrt 2)/4`</td>
		<td>`(sqrt 6+sqrt 2)/4`</td>
		<td>`2-sqrt 3`</td>
	</tr>
</table>

<table>
	<tr>
		<td>`theta`</td>
		<td>`sin theta`</td>
		<td>`cos theta`</td>
		<td>`tan theta`</td>
	</tr>
	<tr>
		<td>`12^@ = pi/15`</td>
		<td>`(sqrt 3 - sqrt 15 + sqrt(10+2sqrt 5))/8`</td>
		<td>`(-1 + sqrt 5 + sqrt(30+6sqrt 5))/8`</td>
		<td>`(3sqrt 3-sqrt 15 + (3sqrt 5-7)sqrt(5+2sqrt 5))/2`</td>
	</tr>
	<tr>
		<td>`6^@ = pi/30`</td>
		<td>`(-1 - sqrt 5 + sqrt(30-6sqrt 5))/8`</td>
		<td>`(sqrt 3 + sqrt 15 + sqrt(10-2sqrt 5))/8`</td>
		<td>`(sqrt 3-sqrt 15+(sqrt 5+1)sqrt(5-2sqrt 5))/2`</td>
	</tr>
</table>

<p class="example" id="exp-cos-pi-5">
  求 `cos{:pi/5:}`.
</p>

<p class="solution">
  设等腰 `triangle ABC` 的顶角 `A` 等于 `pi/5`, 腰长为 `1`, 底长为 `x`.
  作角 `B` 的平分线交 `AC` 于 `D`. 易证 `triangle ABC S~ triangle BCD`,
  所以 `BD = x`, `CD = x^2`. 又 `ABD` 也是等腰三角形, `AD = x`.
  由 `CD+AD = AC` 列出方程 `x^2 + x = 1`, 解得 `x = (-1+sqrt 5)/2`
  (负根舍去). 在 `triangle ABC` 中使用余弦定理:
  <span class="formula">
    `cos{:pi/5:} = (1+1-x^2)/2`
    `= (1+x)/2 = (1+sqrt 5)/4`.
  </span>
</p>

<p class="remark">
  Gauss 在 18 岁时算出了
  <span class="formula">
    `16 cos{:(2pi)/17:}`
    `= -1+sqrt 17+sqrt(34-2sqrt 17)`
    `+sqrt(2(3+sqrt 17)(2sqrt 17-sqrt(34-2sqrt 17)))`.
  </span>
  这是<a href="../abstract/7.html#7-9">尺规作正 17 边形</a>的依据.
</p>

<h2>三角恒等式</h2>

<h3>基本公式</h3>

<h4>勾股定理</h4>

<span class="formula">
	`sin^2 x + cos^2 x = 1`,
	`quad tan^2 x + 1 = 1 // cos^2 x`,
	`quad 1 + cot^2 x = 1 // sin^2 x`,<br/>
	`sec^2 x + csc^2 x = sec^2 x csc^2 x`.
</span>

<h4>周期性</h4>

<span class="formula">
	`sin(x+2pi) = sin x`,
	`quad cos(x+2pi) = cos x`,
	`quad tan(x+pi) = tan x`.
</span>

<h4>反射变换</h4>

<span class="formula">
	`sin(-x) = -sin x`,
	`quad cos(-x) = cos x`,
	`quad tan(-x) = -tan x`,<br/>
	`sin(pi-x) = sin x`,
	`quad cos(pi-x) = -cos x`,
	`quad tan(pi-x) = -tan x`,<br/>
	`sin(pi/2-x) = cos x`,
	`quad tan(pi/2-x) = cot x`,
	`quad tan(pi/4-x) = (1-tan x)/(1+tan x)`.
</span>

<h4>平移变换</h4>

<span class="formula">
	`sin (x + (k pi)/2) = sin x, cos x, -sin x, -cos x`,
	`k = 0, 1, 2, 3`.
</span>

<h3>和角公式</h3>

<h4>和角公式</h4>

<span class="formula">
	`sin (x +- y) = sin x cos y +- cos x sin y`,<br/>
	`cos (x +- y) = cos x cos y &mp; sin x sin y`,<br/>
	`tan (x +- y) = (tan x +- tan y) / (1 &mp; tan x tan y)`,<br/>
	`cot (x +- y) = (cot x cot y &mp; 1) / (cot y +- cot x)`.
</span>

<p class="proof">
	余弦的和角公式:
	考虑两个单位向量 `bm a = (cos x, sin x)`, `bm b = (cos y, sin y)`,
	有
	<span class="formula">
		`cos (x-y)`
		`= cos (:bm a, bm b:)`
		`= (bm a * bm b)/(|bm a| |bm b|)`
		`= bm a * bm b`
		`= cos x cos y + sin x sin y`.
	</span>
	即 `cos(x-y) = cos x cos y + sin x sin y`.<br/>
	正弦的和角公式:
	<span class="formula">
		`sin(x+y)`
		`= cos(pi/2-x-y)`
		`= cos(pi/2-x)cos y + sin(pi/2-x)sin y`
		`= sin x cos y + cos x sin y`.
	</span>
</p>

<p class="collapse">
  复数记忆. 分别考虑下式的实部和虚部:
  <span class="formula">
    `cos(x+y) + "i" sin(x+y) = (cos x + "i" sin x)(cos y + "i" sin y)`.
  </span>
</p>

<p class="remark">
	由和角公式, 可以导出绝大多数的三角恒等式.
</p>

<h4>倍角公式</h4>

<span class="formula">
	`sin 2x = 2 sin x cos x`,
	`quad cos 2x = cos^2 x - sin^2 x`
	`= 1 - 2 sin^2 x`
	`= 2 cos^2 x -1`,<br/>
	`sin 3x = 3 sin x - 4 sin^3 x`
	`= 4 sin x sin(pi/3-x) sin(pi/3+x)`,<br/>
	`cos 3x = 4 cos^3 x - 3 cos x`
	`= 4 cos x cos(pi/3-x) cos(pi/3+x)`,<br/>
	`tan 3x = (3tan x - tan^3 x)/(1-3tan^2 x)`
	`= tan x tan(pi/3-x) tan(pi/3+x)`.
</span>

<p class="proof">
  在<a class="ref" href="#the-sin-prod"></a> 的 2 中取 `n = 3`,
  就得到正弦函数的三倍角公式:
  <span class="formula">
    `sin theta sin(theta+60^@) sin(theta+120^@)`
    `= sin theta sin(60^@+theta) sin(60^@-theta)`
    `= sin(3 theta)// 4`.
  </span>
  在 4. 中取 `n=1` 就得到余弦的三倍角公式;
  两式相除得到正切的三倍角公式.
</p>

<p class="example">
	`sin 20^@ sin40^@ sin80^@ = (sqrt 3)/8`.
</p>

<p class="proof">
  这是三倍角公式的直接推论, 也可以用积化和差验证: 记 `x = 10^@`, 有
	<span class="formula">
    `sin 20^@ * sin40^@ * sin80^@`.
		`1/2 [ cos (4-2)x - cos (4+2)x ] cos x`
		`= 1/2 (cos 2 x - 1/2) cos x`
		`= 1/2 cos 2 x cos x - 1/4 cos x`
		`= 1/4 [ cos(2+1)x + cos(2-1)x ] - 1/4 cos x`
		`= (sqrt 3)/8`.
	</span>
</p>

<h4>半角公式</h4>

<span class="formula">
	`sin^2 x = (1 - cos 2x)//2`,
	`quad cos^2 x = (1 + cos 2x)//2`,
	`quad tan^2 x = (1 - cos 2x)/(1 + cos 2x)`,<br/>
	`tan{:(x+y)/2:} = (sin x + sin y)/(cos x + cos y)`
	`= - (cos x - cos y)/(sin x - sin y)`,<br/>
	`tan{:x/2:} = csc x - cot x = (1 - cos x)/(sin x)`
	`= (sin x)/(1 + cos x) = (csc x + cot x)^-1`,<br/>
	`tan(pi/4 +- x/2) = sec x +- tan x`,<br/>
	`1 +- sin 2x = (sin x +- cos x)^2`,<br/>
  `(1 - sin 2x)/(1 + sin 2x) = ((1 - tan x)/(1 + tan x))^2`.
</span>

<h4>和差化积</h4>

<span class="formula">
	`sin x +- sin y = 2 sin{:(x+-y)/2:} cos{:(x&mp;y)/2:}`,<br/>
	`cos x + cos y = 2 cos{:(x+y)/2:} cos{:(x-y)/2:}`,<br/>
	`cos x - cos y = -2 sin{:(x+y)/2:} sin{:(x-y)/2:}`,<br/>
</span>

<p class="collapse">
  记忆:
  <span class="formula">
    `color(red)(sin x + sin y) + color(blue)(sin x - sin y)`
    `= 2sin((x+y)/2 + (x-y)/2)`
    `= color(red)(2 sin{:(x+y)/2:} cos{:(x-y)/2:})
    + color(blue)(2 cos{:(x+y)/2:} sin{:(x-y)/2:})`,<br/>
    `color(red)(cos x + cos y) + color(blue)(cos x - cos y)`
    `= 2cos((x+y)/2 + (x-y)/2)`
    `= color(red)(2 cos{:(x+y)/2:} cos{:(x-y)/2:})
    color(blue)(- 2sin{:(x+y)/2:} sin{:(x-y)/2:})`.
  </span>
  考虑关于 `x, y` 的对称性, 就能确定红/蓝的对应关系.
</p>

<p class="collapse">
  复数记忆. 分别考虑下式的实部和虚部:
  <span class="formula">
    `exp("i"x) + exp("i"y) = exp("i"(x+y)/2) exp("i"(x-y)/2) + exp("i"(x+y)/2) exp(-"i"(x-y)/2)`,
  </span>
  即
  <span class="formula align">
    `cos x + cos y + "i"(sin x + sin y)`<br>
    `= (cos{:(x+y)/2:} + "i" sin{:(x+y)/2:})(cos{:(x-y)/2:} + "i" sin{:(x-y)/2:})`<br>
    `+ (cos{:(x+y)/2:} + "i" sin{:(x+y)/2:})(cos{:(x-y)/2:} - "i" sin{:(x-y)/2:})`.
  </span>
</p>

<h4>积化和差</h4>

<span class="formula">
	`2 sin x cos y = sin(x+y) + sin(x-y)`,<br/>
	`2 cos x cos y = cos(x-y) + cos(x+y)`,<br/>
	`2 sin x sin y = cos(x-y) - cos(x+y)`,<br/>
	`tan x tan y = (cos(x-y) - cos(x+y))/(cos(x-y)-cos(x+y))`.
</span>

<h4>平方差</h4>

<span class="formula">
  `sin(x+y) sin(x-y) = sin^2 x - sin^2 y = cos^2 y - cos^2 x`,<br>
  `cos(x+y) cos(x-y) = cos^2 x - sin^2 y = cos^2 y - sin^2 x`.
</span>

<h4>万能代换</h4>

<p>	令 `t = tan {:x/2:}`, 有 `x = 2 arctan t`, 从而
	<span class="formula">
		`dx = (2 dt)/(1+t^2)`,
		`quad sin x = (2t)/(1+t^2)`,
		`quad tan x = (2t)/(1-t^2)`,
		`quad cos x = (1-t^2)/(1+t^2)`,
		`quad "e"^("i"x) = (1+"i"t)/(1-"i"t)`.
	</span>
    万能代换公式可借助下图记忆, 其中 `dx` 是 `sin x` 的小量近似.
</p>

<div class="img xs">
  <img src="../img/universal-formula.svg" alt="万能代换">
</div>

<h3>辅助角公式</h3>

<span class="formula">
	`A sin x + B cos x = sqrt(A^2+B^2) sin(x+varphi)`,
	`quad tan varphi = B/A`;<br/>
	`(1 + C tan x)/(C - tan x) = tan (x+varphi)`,
	`quad cot varphi = C`.
</span>

<p class="example">
  求 `(11 sin theta + 13)/(17 cos theta + 23)` 的取值范围.
</p>

<p class="solution">
  令结果为 `z`, 构造辅助角:
  <span class="formula">
    `11 sin theta + 13 = (17 cos theta + 23) z`,<br>
    `sqrt(11^2 +(17z)^2) sin(theta + varphi) = 23z - 13`.
  </span>
  于是
  <span class="formula">
    `(23z - 13)^2 le 11^2 + (17z)^2`,
  </span>
  解得 `z = (299+-sqrt(77881))/240`, 约为 0.083 和 2.409.
</p>

<p class="solution">
  考虑几何意义, 问题化为: 已知 `y = 13//11 + sin theta`, `x = 23//17 + cos
  theta`, 求 `z = 11y//17x` 的取值范围. `(x, y)` 的轨迹是圆, 故 `z`
  在该圆过原点的切线处取得最值.  记 `k = (13//11)/(23//17)`, `r = sqrt((13//11)^2 + (23//17)^2)`, `t = 1//sqrt(r^2-1)`, 则两条切线的斜率分别是
  <span class="formula">
    `(k +- t)/(1 &mp; k t)`.
  </span>
  `z` 的取值范围是上式乘以 `11/17`, 约为 0.083 和 2.409.
</p>

<p class="example">
  <b>任意两个正弦波的叠加</b>
  记 `y_i = omega_i x + varphi_i`, `i = 1, 2`,
  假设 `omega_1 gt omega_2`, 则利用和差化积与辅助角公式有
  <span class="formula align">
    `A_1 sin(omega_1 x + varphi_1) + A_2 sin(omega_2 x + varphi_2)`<br>
    `= (A_1+A_2)/2 (sin y_1 + sin y_2) + (A_1-A_2)/2 (sin y_1 - sin y_2)`<br>
    `= (A_1+A_2) sin{:(y_1+y_2)/2:} cos{:(y_1-y_2)/2:}`
    `+ (A_1-A_2) sin{:(y_1-y_2)/2:} cos{:(y_1+y_2)/2:}`<br>
    `= A sin((y_1+y_2)/2 + gamma)`,
  </span>
  其中
  <span class="formula align">
    `A^2 = (A_1+A_2)^2 cos^2{:(y_1-y_2)/2:}
    + (A_1-A_2)^2 sin^2{:(y_1-y_2):}`<br>
    `= A_1^2 + A_2^2 + 2 A_1 A_2 cos(y_1-y_2)`,<br>
    `tan gamma = (A_1-A_2)/(A_1+A_2) tan{:(y_1-y_2)/2:}`.
  </span>
  合成后的函数 `A sin((y_1+y_2)/2 + gamma)`,
  振动频率大约是 `(omega_1 + omega_2)//2`.  观察 `A` 的表达式, 由于 `A^2`
  的频率为 `omega_1-omega_2`, 则 `A` 的频率大约为 `(omega_1-omega_2)//2`,
  这就是说函数的振幅被 `(omega_1-omega_2)//2` 这个低频调制.
</p>

<h3>求和公式与乘积公式</h3>

<p class="example">
  <b>正弦、余弦求和公式</b>
  `x` 不等于 `2pi` 的整数倍时,
	<span class="formula">
		`sum_(k=1)^n cos kx`
		`= cos {:((n+1)x)/2:} sin {:(nx)/2:} // sin{:x/2:}`,<br/>
		` sum_(k=1)^n sin kx
		= sin {:((n+1)x)/2:} sin {:(nx)/2:} // sin {:x/2:}`.
	</span>
  特别取 `x = 2pi//n`,
	<span class="formula">
		`sum_(k=1)^n cos {:(2k pi)/n:}`
		`= sum_(k=1)^n sin {:(2k pi)/n:} = 0`.
	</span>
	这个等式的几何意义是,
	向量组 `( cos {:(2k pi)/n:}, sin {:(2k pi)/n:} )`,
	`k = 1, 2, cdots, n`, 中所有向量之和为零, 因为它们恰好围成一个正 `n`
  边形.
</p>

<p class="proof">
	只证第一式. 第二式类似. 利用积化和差与和差化积:
	<span class="formula">
		`2 sin{:x/2:} sum_(k=1)^n cos kx`
		`=	sum_(k=1)^n [sin(k+1/2)x - sin(k-1/2)x]`
		`= sin(n+1/2)x - sin{:x/2:}`
		`= 2 cos {:((n+1)x)/2:} sin {:(nx)/2:}`.
	</span>
</p>

<p class="corollary">
  类似地, 通过乘因子 `2 cos(x//2)` 得到
  <span class="formula">
    `2 sum_(k=1)^n (-1)^(k-1) cos k x`
    `= 1 + (-1)^(n-1) cos(n+x//2) // cos(x//2)`,<br>
    `2 sum_(k=1)^n (-1)^(k-1) sin k x`
    `= tan (x//2) + (-1)^(n-1) sin(n x+x//2) // cos(x//2)`;
  </span>
  [来自群友 菜鸟 Math] 乘因子 `2 sin{:pi/(2n+1):}` 得到
  <span class="formula">
    `2 sum_(k=1)^n cos{:(2k-1)/(2n+1) pi:} = 1`,<br>
    `2 sum_(k=1)^n sin{:(2k-1)/(2n+1) pi:} = cot{:pi/(4n+2)`.
  </span>
</p>

<ol class="example">
  <b>正切、余切求和公式</b>
  [来自 <a href="https://math.stackexchange.com/questions/346368/sum-of-tangent-functions-where-arguments-are-in-specific-arithmetic-series" target="_blank">stack exchange</a>]
  记 `theta_k = theta + (k pi)/n`, 则
  <li>`sum_(0 le k lt n) tan theta_k` `= n tan(n theta + (n-1)pi//2)`;<br>
    `n` 为奇数时, 等号右边等于 `n tan n theta`;
    `n` 为偶数时, 等于 `-n cot n theta`.
  </li>
  <li>`sum_(0 le k lt n) cot theta_k` `= n cot n theta`.
  </li>
</ol>

<p class="proof">
  只证 1. 考虑方程 `tan n x = tan n theta`, 它的 `n` 个根为
  <span class="formula">
    `x = theta_k`, `quad k = 0, cdots, n-1`.
  </span>
  用 De Moivre 公式得到 `tan` 的 `n` 倍角公式:
  <span class="formula">
    `tan n x`
    `= (sin n x)/(cos n x)`
    `= ((n;1) cos^(n-1) x sin x - (n;3) cos^(n-3) x sin^3 x + cdots)
    / (cos^n x - (n;2) cos^(n-2) x sin^2 x + cdots)`
    `= ((n;1) tan x - (n;3) tan sin^3 x + cdots)
    / (1 - (n;2) tan^2 x + cdots)`.
  </span>
  `n = 2m` 时, 方程写为
  <span class="formula">
    `((n;1) tan x - (n;3) tan^3 x + cdots + (2m;2m-1)(-1)^(m-1) tan^(2m-1)x)/(1-(2m;2)tan^2 x + cdots + (-1)^m tan^(2m) x) = tan 2m theta`.
  </span>
  即
  <span class="formula">
    `(tan 2m theta) tan^(2m) x + (2m) tan^(2m-1) x + cdots = 0`.
  </span>
  这是关于 `tan x` 的 `2m` 次方程, 由 Vieta 定理得到 `n` 个根之和:
  <span class="formula">
    `sum_(0 le k lt n) tan theta_k`
    `= - (2m)/(tan 2m theta)`
    `= -n cot n theta`.
  </span>
  `n = 2m+1` 时证明类似.
</p>

<ol class="example" id="the-sin-prod">
  <b>三角函数乘积公式</b>
  <li>`prod_(0 lt k lt n) sin {:(k pi)/n:} = 2^(1-n) * n`;</li>
  <li>`prod_(0 lt k lt n) cos {:(k pi)/n:} = 2^(1-n) * cos((n-1)pi//2)`;<br>
    `n` 为奇数时, 等号右边为 `(2"i")^(1-n)`, `n` 为偶数时, 为 `0`.
    推论:
    <span class="formula">
      `prod_(1 le k le n) cos {:(k pi)/(2n+1):} = 2^-n`.
    </span>
  </li>
</ol>

<ol class="proof">
<li>
  取 `n` 次单位根 `x_k = "e"^((2k pi)/n "i")`, 则多项式 `x^n-1`
  可以分解为
  <span class="formula">
    `x^n-1 = prod_(0 le k lt n) (x-x_k)`
  </span>
  两边同除以 `x-1` 得
  <span class="formula">
    `sum_(0 le k lt n) x^k = prod_(0 lt k lt n) (x-x_k)`,
  </span>
  令 `x = 1`, 两边平方得
  <span class="formula">
    `n^2 = prod_(0 lt k lt n) (1-x_k)^2`.
  </span>
  上式右边的乘积取遍 `0` 以外的 `n` 次单位根. 根据对称性, 可以把其中一半换成共轭:
  <span class="formula">
    `n^2 = prod_(0 lt k lt n) (1-x_k)(1-bar x_k)`
    `= prod_(0 lt k lt n) |1-x_k|^2`.
  </span>
  再由几何关系, `|1-x_k| = 2 sin {: ("arg" x_k)/2 :} = 2 sin {:(k pi)/n:}`, 故
  <span class="formula">
    `n = 2^(n-1) prod_(0 lt k lt n) sin {:(k pi)/n:}`.
  </span>
  </li>
  <li>在 1. 中令 `x = -1`, 再分奇偶讨论.</li>
</ol>

<ol class="example">
  [来自群友 我是薛定谔的猫]
  记 `theta_k = theta + (k pi)/n`, 则
  <li> `prod_(0 le k lt n) sin theta_k = 2^(1-n) sin n theta`;
  </li>
  <li>`prod_(0 le k le n) cos theta_k = 2^(1-n) cos(n theta + (n-1)pi//2)`;<br>
    `n` 为奇数时, 等号右边等于 `(2"i")^(1-n) cos n theta`;
    `n` 为偶数时, 等于 `"i"^n 2^(1-n) sin n theta`.
  </li>
  <li>`prod_(k=1)^n cos x_k = 1/2^n sum_(e in S)
      cos(e_1 x_1 + cdots + e_n x_n)`, `S = {1, -1}^n`.
  </li>
</ol>

<ol class="proof">
  <li>方程 `x^n = "e"^(-2"i"n theta)` 的 `n` 个根为 `"e"^(-2"i"theta_k)`,
    `k = 0, cdots, n-1`, 故有多项式分解
    <span class="formula">
      `prod_(0 le k lt n) (x-"e"^(-2"i"theta_k))`
      `= x^n - "e"^(-2"i"n theta)`.
    </span>
    上式取 `x = 1`, 两边同乘
    <span class="formula">
      `exp("i"sum_(0 le k lt n) theta_k)`
      `= exp("i"(n theta + pi/2 (n-1)))`
      `= "i"^(n-1) "e"^("i" n theta)`,
    </span>
    得到
    <span class="formula">
      `prod_(0 le k lt n) ("e"^("i"theta_k)-"e"^(-"i"theta_k))`
      `= ("e"^("i"n theta) - "e"^(-"i"n theta)) "i"^(n-1)`,
    </span>
    即得证.
  </li>
  <li>在 2. 中令 `x = -1`, 再分奇偶讨论.</li>
</ol>

<p class="proposition" id="prop-sum-sq-cot">
  `sum_(k=1)^n cot^2{:(k pi)/(2n+1):} = 1/3 (2n;2)`.
  利用这个恒等式可以证明 `zeta(2) = pi^2//6`, 参见 <a href="../analysis/10.html#prop-basel">Basel 问题</a>.
</p>

<p class="proof">
  记 `N = 2n+1`, 用 De Moivre 公式得到
  <span class="formula">
    `(cot theta + "i")^N`
    `= (cos theta + "i" sin theta)^N/(sin^N theta)`
    `= (cos N theta + "i" sin N theta)/(sin^N theta)`.
  </span>
  两边取虚部,
  <span class="formula">
    `(2n+1) cot^(2n) theta - (2n+1;3) cot^(2n-2) theta + cdots + (-1)^n`
    `= (sin (2n+1) theta)/(sin^(2n+1) theta)`.
  </span>
  上式左边是 `cot^2 theta` 的 `n` 次多项式, 它的所有根为
  <span class="formula">
    `cot^2 theta_k`, `quad theta_k = (k pi)/(2n+1)`, `quad k = 1, cdots, n`.
  </span>
  由 Vieta 定理, 它的所有根之和为
  <span class="formula">
    `1/(2n+1) (2n+1;3) = 1/3 (2n;2)`.
  </span>
</p>

<p class="proof">
  [来自 折棒]
  记 `N = 2n+1`, 从三角形中的恒等式 `sum_"cyc" cot A cot B = 1` 出发,
  对全体满足 `a + b + c = N` 的正整数 `a, b, c` 求和, 用插空法得到
  <span class="formula">
    `sum_(stackrel(a+b+c=N)(a, b, c in ZZ^+))
    sum_"cyc" cot{:(a pi)/N:}cot{:(b pi)/N:} = (2n;2)`.
  </span>
  对任意 `a != b`, 上式左边形如 `cot{:(a pi)/N:}cot{:(b pi)/N:}`
  的非平方项有 6 个, 而形如 `cot^2{:(a pi)/N:}` 的平方项有 3 个.
  我们来证明这些非平方项相互抵消; 事实上, 所有非平方项的集合为
  <span class="formula">
    `S = { (a, b): a, b in ZZ^+, a != b, a + b lt N }`
  </span>
  注意到 `N` 是奇数, 因而
  <span class="formula">
    `(a, b) mapsto {
      (a, N-b), if a lt b;
      (N-a, b), if a gt b;
    :}`
  </span>
  是 `S` 上的双射.
  换言之, 每个非平方项 `cot{:(a pi)/N:}cot{:(b pi)/N:}` 都对应另一项
  `cot{:(a pi)/N:}cot{:(N-b)/N pi:}`. 这两项的和为 0, 正好抵消.
  <br>
  最后, 将和式左边所有平方项相加, 由于 `a + b lt N`, 故 `a = b` 的最大取值为 `n`; 我们有
  <span class="formula">
    `3 sum_(k=1)^n cot^2{:(a pi)/N:} = (2n;2)`.
  </span>
</p>

<p class="example">
  [来自 我是从物理群来潜伏的内鬼]
  `a, b in RR`, `n ge 2` 为正整数, 证明恒等式
  <span class="formula">
    `n sin(a + (n-2)b)/sin(n b)`
    `= sum_(0 le k lt n) sin(a + 2 k pi//n)/tan(b + k pi//n)`.
  </span>
</p>

<ol class="proof">
  [来自 COL]
  <li>记 `a-2b = c`, `n b = Y`, 左边等于
    <span class="formula">
      `n sin(c + Y)/sin Y`
      `= n (sin c cos Y + cos c sin Y)/sin Y`
      `= n(sin c cot Y + cos c)`.
    </span>
    又记 `2b + 2 k pi//n = X`, 则 `sum sin X = sum cos X = 0`.
    利用恒等式 `tan (X//2) = (sin X)/(1 + cos X)`, 右边等于
    <span class="formula align">
      `sum sin(c + X)/tan(X//2)`<br>
      `= sum (sin c cos X + cos c sin X) (1+cos X)/sin X`<br>
      `= sum (sin c cot X + cos c)(1 + cos X)`<br>
      `= sin c sum cot X (1 + cos X) + n cos c + 0`.
    </span>
  </li>
  <li>
    比较左右两边, 下面只需证
    <span class="formula">
      `sum cot X (1 + cos X) = n cot Y`.
    </span>
    左边等于
    <span class="formula align">
      `sum cos X (1 + cos X)/sin X`<br>
      `= sum cos X cot(X//2)`<br>
      `= sum (1-2sin^2(X//2)) cot(X//2)`<br>
      `= sum cot(X//2) - sum sin X`<br>
      `= sum cot(X//2)`.
    </span>
    利用余切求和公式即得结论.
  </li>
</ol>

<h3 id="equality-of-triangle">三角形中的恒等式与不等式</h3>

<p class="example">
	设 `A + B + C = pi`, 则
	<span class="formula">
		`sin A + sin B + sin C = 4 cos{:A/2:} cos{:B/2:} cos{:C/2:}`,<br/>
		`cos A + cos B + cos C = 1 + 4 sin{:A/2:} sin{:B/2:} sin{:C/2:}`,<br/>
		`sin 2A + sin 2B + sin 2C = 4 sin A sin B sin C`,<br/>
		`cos 2A + cos 2B + cos 2C = -1 - 4 cos A cos B cos C`,<br/>
		`sin^2 A + sin^2 B + sin^2 C = 2 + 2 cos A cos B cos C`,<br/>
		`cos^2 A + cos^2 B + cos^2 C = 1 - 2 cos A cos B cos C`,<br/>
		`sin^2{:A/2:} + sin^2{:B/2:} + sin^2{:C/2:} =
		1 - 2 sin{:A/2:} sin{:B/2:} sin{:C/2:}`,<br/>
		`tan A + tan B + tan C = tan A tan B tan C`,<br/>
		`cot{:A/2:} + cot{:B/2:} + cot{:C/2:} = cot{:A/2:} cot{:B/2:}
		cot{:C/2:}`,<br/>
		`tan{:A/2:} tan{:B/2:} + tan{:B/2:} tan{:C/2:} + tan{:C/2:} tan{:A/2:} = 1`.
	</span>
</p>

<ol class="theorem">
	[<a href="https://www.cut-the-knot.org/m/Geometry/InequalitiesInTriangle.shtml" target="_blank">几何不等式</a>]
	`triangle ABC` 中以下不等式成立, 其中等号成立当且仅当 `ABC`
	是正三角形.
	<li>`sin{:A/2:} sin{:B/2:} sin{:C/2:} le 1/8`,
		`cos A + cos B + cos C le 3/2`,<br/>
		`cos A cos B cos C le 1/8`,
		`sin{:A/2:} + sin{:B/2:} + sin{:C/2:} le 3/2`;
	</li>
	<li>`cos{:A/2:} cos{:B/2:} cos{:C/2:} le (3 sqrt 3)/8`,
		`sin A + sin B + sin C le (3 sqrt 3)/2`,<br/>
		`sin A sin B sin C le (3 sqrt 3)/8`,
		`cos{:A/2:} + cos{:B/2:} + cos{:C/2:} le (3 sqrt 3)/2`;
	</li>
	<li>`tan{:A/2:} + tan{:B/2:} + tan{:C/2:} ge sqrt 3`,
		`cot A + cot B + cot C ge sqrt 3`.
	</li>
</ol>

<ol class="proof">
	<li>由余弦定理,
		<span class="formula">
			`a^2 = b^2 + c^2 - 2b c cos A`
			`= (b-c)^2 + 4b c sin^2{:A/2:}`,
		</span>
		因此 `sin{:A/2:} le a/(2sqrt(b c))`.
		对 `A, B, C` 轮换并相乘即得第一式成立.  利用
		<span class="formula">
			`cos A + cos B + cos C
			= 1 + 4 sin{:A/2:} sin{:B/2:} sin{:C/2:}`
		</span>
		得到第二式, 再利用均值不等式得到第三式.
		最后, 令 `alpha = (pi-A)/2`, `beta = (pi-B)/2`, `gamma
		= (pi-C)/2`, 则 `alpha + beta + gamma = pi`,
		于是
		<span class="formula">
			`sin{:A/2:} + sin{:B/2:} + sin{:C/2:}`
			`= cos alpha + cos beta + cos gamma le 3/2`.
		</span>
	</li>
	<li>由 1,
		<span class="formula">
			`2(cos^2{:A/2:} + cos^2{:B/2:} + cos^2{:C/2:})`
			`= 3 + cos A + cos B + cos C le 9/2`.
		</span>
		于是
		<span class="formula">
			`root 3(cos{:A/2:} cos{:B/2:} cos{:C/2:})`
			`le sqrt((cos^2{:A/2:} + cos^2{:B/2:} + cos^2{:C/2:})/3)`
			`le sqrt(3)/2`,
		</span>
		即得第一式. 利用
		<span class="formula">
			`sin A + sin B + sin C = 4 cos{:A/2:} cos{:B/2:} cos{:C/2:}`
		</span>
		得到第二式. 再利用均值不等式得到第三式.
		最后,
		<span class="formula">
			`cos{:A/2:} + cos{:B/2:} + cos{:C/2:}`
			`= sin alpha + sin beta + sin gamma`
			`le (3 sqrt 3)/2`.
		</span>
	</li>
	<li>由不等式
		<span class="formula">
			`(x+y+z)^2 = x^2+y^2+z^2 + 2(x y+y z+z x)`
			`ge 3(x y+y z+z x)`
		</span>
		和等式
		<span class="formula">
			`tan{:A/2:} tan{:B/2:} + tan{:B/2:} tan{:C/2:}
			+ tan{:C/2:} tan{:A/2:} = 1`
		</span>
		即得第一式.
		最后, 令 `A = (pi-u)/2`, `B = (pi-v)/2`, `C = (pi-w)/2`,
		则 `u + v + w = pi`. 于是
		<span class="formula">
			`cot A + cot B + cot C`
			`= tan{:u/2:} + tan{:v/2:} + tan{:w/2:} ge sqrt 3`.
		</span>
	</li>
</ol>

<p class="proof">
	`sin A + sin B + sin C le (3sqrt 3)/2` 的另一证明:
	在 `[0,pi]` 上对 `sin x` 应用 Jensen 不等式
	<span class="formula">
		`sqrt(3)/2 = sin{:(A+B+C)/3:}`
		`ge (sin A + sin B + sin C)/3`.
	</span>
	于是, 完全可以从 2. 的系列不等式出发, 导出 1. 的不等式.
</p>

<p class="proof">
	(繁琐) `cos A cos B cos C le 1/8` 的直接证法: 将等式
	<span class="formula">
		`cos^2 A + cos^2 B + cos^2 C = 1 - 2 cos A cos B cos C`
	</span>
	代入不等式
	<span class="formula">
		`root 3 (cos A cos B cos C) le sqrt((cos^2 A + cos^2 B + cos^2 C)/3)`,
	</span>
	记 `p = cos A cos B cos C`, 有
	<span class="formula">
		`p^2 le ((1-2p)/3)^3`,
	</span>
	解得 `p in [-1, 1//8]`.
	(多项式 `8p^3 + 15p^2 + 6p-1` 的有理根形如 `a_1/a_8`,
	`a_1 | 1`, `a_8 | 8`. 代入验证可知 `1/8` 是它的一根,
	再由多项式除法得到另外一对重根 `-1`).
</p>

<p class="corollary">
	圆内接三角形中, 正三角形面积最大.
</p>

<p class="proof">
	设圆 `O` 的半径为 `r`, `ABC` 是它的内接三角形,
	`/_AOB, /_BOC, /_COA` 分别记为 `2x, 2y, 2z`, 则 `ABC` 的面积
	<span class="formula">
		`S = r^2/2(sin 2x + sin 2y + sin 2z)`
		`= 2r^2 sin x sin y sin z`
		`le (3sqrt 3)/4 r^2`.
	</span>
	等号成立当且仅当 `ABC` 是正三角形.
</p>

<ol class="theorem">
  <b>带系数的几何不等式</b> [来自 <a href="http://blog.sina.cn/dpool/blog/s/blog_560882210100li8w.html" target="_blank">新浪博客</a>]
  对任意正数 `x, y, z` 和三角形内角 `A, B, C` 有
  <li>
    <span class="formula">
      `2 sum_"cyc" x y cos C le sum_"cyc" x^2`,
    </span>
    等号成立当且仅当
    <span class="formula">
      `sin A // x = sin B // y = sin C // z`.
    </span>
    把 `x, y, z` 换成自身的倒数, 得
    <span class="formula">
      `2 sum_"cyc" x cos A le sum_"cyc" y z // x`.
    </span>
    取 `x = a, y = b, z = c` 得到三角形 `ABC` 的垂足三角形周长上界:
    <span class="formula">
      `sum_"cyc" a cos A le 1/2 sum_"cyc" b c // a`.
    </span>
    取 `x = sin A, y = sin B, z = sin C` 得
    <span class="formula">
      `sum_"cyc" sin 2A le sum_"cyc" sin B sin C // sin A`.
    </span>
    分别取 `x = cos A, y = cos B, z = cos C` 和 `x = cos C // cos B`... 得
    <span class="formula">
      `2 sum_"cyc" cos^2 A le sum_"cyc" cos B cos C // cos A`
      `le 1/2 sum_"cyc" (cos B//cos C)^2`.
    </span>
  </li>
  <li>
    <span class="formula">
      `-2 sum_"cyc" x y cos 2 C le sum_"cyc" x^2`,
    </span>
    等号成立当且仅当
    <span class="formula">
      `(y z)/(y+z-x) sin^2 A = (z x)/(z+x-y) sin^2 B = (x y)/(x+y-z) sin^2 C`.
    </span>
    应用二倍角公式得
    <span class="formula">
      `sum_"cyc" x sin^2 A le 1/4 sum_"cyc" x y`.
    </span>
  </li>
</ol>

<p class="proof">
  由下式知 1. 成立:
  <span class="formula">
    `x^2 + y^2 + z^2 - 2 sum_"cyc" x y cos C`
    `= (x-z cos B-y cos C)^2 + (y sin C - z sin B)^2`.
  </span>
  由下式知 2. 成立:
  <span class="formula">
    `x^2 + y^2 + z^2 + 2 sum_"cyc" x y cos 2C`
    `= (x+z cos 2B+y cos 2C)^2 + (y sin 2C - z sin 2B)^2`.
  </span>
</p>

<h2>反三角函数</h2>

<table>
	<tr>
		<td></td>
		<td>定义域</td>
		<td>值域</td>
	</tr>
	<tr>
		<td>`arcsin x`</td>
		<td>`[-1, 1]`</td>
		<td>`[-pi/2, pi/2]`</td>
	</tr>
	<tr>
		<td>`arccos x`</td>
		<td>`[-1, 1]`</td>
		<td>`[0, pi]`</td>
	</tr>
	<tr>
		<td>`arctan x`</td>
		<td>`(-oo, +oo)`</td>
		<td>`(-pi/2, pi/2)`</td>
	</tr>
	<tr>
		<td>`" arccot "x`</td>
		<td>`(-oo, +oo)`</td>
		<td>`(0, pi)`</td>
	</tr>
</table>

<p>	其中
	<span class="formula">
		`"arccot "x := {
			arctan{:1/x:}, if x gt 0;
			pi/2, if x = 0;
			arctan{:1/x:}+pi, if x lt 0;
		:}`
	</span>
	因为上面 4 个反三角函数都在各自的定义域上单调,
	所以对所有定义域中的 `x`,
	<span class="formula">
		`sin arcsin x = x`.
	</span>
	其它三个类似.
</p>

<h4>互余关系, 反射变换</h4>

<span class="formula">
	`arcsin x + arccos x = pi/2`
	`quad arctan x + "arccot "x = pi/2`,<br/>
	`arcsin(-x) = -arcsin x`,
	`quad arctan(-x) = -arctan x`,<br/>
	`arccos(-x) + arccos x =  pi`,
	`quad "arccot"(-x) + "arccot" x = pi`.
</span>

<p class="proof">
	我们只证 `arcsin`, `arccos` 的相关公式. 先证明
	<span class="formula">
		`arcsin x = pi/2 - arccos x`.
	</span>
	考察 `arcsin x` 和 `arccos x` 的值域可知,
	上式两边之差的绝对值不超过 `2 pi`, 所以上式成立当且仅当
	<span class="formula">
		`sin arcsin x = sin (pi/2 - arccos x)`,
	</span>
	即 `x = cos arccos x`, 这显然成立.
	又 `arcsin x` 是 `sin x` 在对称区间 `[-pi/2, pi/2]` 上的反函数,
	而 `sin x` 为奇函数, 所以 `arcsin x` 也为奇函数. 最后
	<span class="formula">
		`arccos(-x) = pi/2 - arcsin(-x)`
		`= pi/2 + arcsin x = pi/2 + pi/2 - arccos x`.
	</span>
</p>

<h4>勾股互化</h4>

<p>	`x gt 0` 时, 通过画图容易得知</p>

<span class="formula">
	` arcsin x = arccos sqrt(1-x^2)`
	`= arctan {:x/sqrt(1-x^2):}`,<br/>
	`arccos x = arcsin sqrt(1-x^2)`
	`= arctan{:sqrt(1-x^2)/x:}`,<br/>
	`arctan x = arccos{:1/sqrt(1+x^2):}`
	`= arcsin{:x/sqrt(1+x^2):}`.
</span>

<p>	`x lt 0` 时, 令 `x = -y`, 再对 `y` 应用上述公式.
	适当利用反三角函数的反射变换.
	比如 `x lt 0` 时,
	<span class="formula">
		`arccos x = arccos(-y) = pi-arccos y`
		`= pi - arctan{:sqrt(1-y^2)/y:}`
		`= pi + arctan{:sqrt(1-x^2)/x:}`.
	</span>
</p>

<h4>反函数性质</h4>

<p>	前面已经提到,
	<span class="formula">
		`sin arcsin x = x`,
		`quad cos arccos x = x`,
		`quad tan arctan x = x`.
	</span>
	反之就比较复杂, 需要适当地作<b>平移变换</b>, 将 `x-n pi`
	落入反三角函数的值域中:
	<span class="formula">
		`arcsin sin x = (-1)^n (x-n pi)`, `quad |x-n pi| le pi/2`,<br/>
		`arccos cos x = (-1)^n (x-n pi) + [n" odd"] pi`,
		`quad 0 le x-n pi le pi`,<br/>
		`arctan tan x = x-n pi`, `quad |x - n pi| lt pi/2`,<br/>
	</span>
	其中 `[n" odd"] = {1, if n" is odd"; 0, if n" is even" :}`
</p>

<p>	利用勾股互化, 得到
	<span class="formula">
		`cos arcsin x = sin arccos x = sqrt(1-x^2)`,
	</span>
	当然, 也可以从值域来考虑. 比如 `arcsin x` 值域是 `[-pi/2,
	pi/2]`, 而在这一区间上 `cos` 函数非负, 所以结果的符号为正.
</p>

<h4>差角公式</h4>

<p>
	介绍差角而不是和角, 是因为前者在数学分析中更常用.
	<span class="formula">
		`arcsin sin(arcsin x - arcsin y)`
		`= arcsin(x sqrt(1-y^2) - y sqrt(1-x^2))`,
		`arccos cos(arccos x - arccos y)`
		`= arccos(x y+sqrt(1-x^2) sqrt(1-y^2))`,
		`arctan tan(arctan x - arctan y)`
		`= arctan{:(x - y)/(1+x y):}`,
	</span>
	条件
	<span class="formula">
		`|arcsin x - arcsin y| le pi/2` `iff x y ge 0 or x^2+y^2 le 1`,
		<br/>
		`0 le arccos x - arccos y le pi` `iff x le y`,<br/>
		`|arctan x - arctan y| lt pi/2` `iff x y gt -1`.
	</span>
	分别成立时, 上面三个等式分别等于
	<span class="formula">
		`arcsin x - arcsin y`,
		`arccos x - arccos y`,
		`arctan x - arctan y`.
	</span>
</p>

<ol class="proof">
	我们来证明那些使公式成立的等价条件.
	<li>首先由 `arccos` 的值域为 `[0, pi]` 知 `arccos x - arccos y le pi`
		恒成立.
		又由 `arccos` 单调递减知 `arccos x - arccos y ge 0 iff x le y`.
	</li>
	<li>记 `a = arctan x`, `b = arctan y`, 由值域知
		`-pi/2 lt a, b lt pi/2`, 所以 `cos a, cos b gt 0`.
		若 `|a-b| lt pi/2`,
		<span class="formula">
			`0 lt cos(a-b) = cos a cos b + sin a sin b`
			`= cos a cos b(1 + tan a tan b)`
		</span>
		这推出 `x y+1 = tan a tan b + 1 gt 0`.
		反之若 `x y gt -1`, 可得 `cos(a-b) gt 0`
		但由 `-pi/2 lt a, b lt pi/2` 知 `|a-b| lt pi`,
		于是必有 `|a-b| lt pi/2`.
		这个条件的几何意义是, 若两角之差是锐角, 且两直线与 `x`
		轴正方向的夹角分别等于这两个角, 则两直线斜率之积大于 `-1`.
	</li>
	<li>记 `a = arcsin x`, `b = arcsin y`.  若 `|a-b| le pi/2`,
		<span class="formula">
			`0 le cos(a-b) = cos a cos b + sin a sin b`.
		</span>
		即
		<span class="formula">
			`-x y le sqrt(1-x^2) sqrt(1-y^2)`.
		</span>
		假设 `x y lt 0`, 上式化为
		<span class="formula">
			`|x y| le sqrt(1-x^2) sqrt(1-y^2)`,
		</span>
		两边平方得
		<span class="formula">
			`x^2 y^2 le (1-x^2)(1-y^2) = 1 - (x^2+y^2) + x^2 y^2`.
		</span>
		即
		<span class="formula">
			`x^2+y^2 le 1`.
		</span>
		反之, 若 `x y ge 0` 或 `x^2+y^2 le 1` 成立, 都可以推出
		<span class="formula">
			`-x y le sqrt(1-x^2) sqrt(1-y^2)`
		</span>
		成立, 这等价于 `cos(a-b) ge 0`, 从而等价于 `|a-b| le pi/2`.
	</li>
</ol>

<p>	条件不成立时, 使用平移变换. 比如, 取合适的 `n` 使得
	`|arcsin x - arcsin y - n pi| le pi/2`, 则
	<span class="formula">
		`arcsin sin(arcsin x - arcsin y)`
		`= (-1)^n (arcsin x - arcsin y - n pi)`
	</span>
	于是
	<span class="formula">
		`arcsin x - arcsin y`
		`= n pi + (-1)^n arcsin(x sqrt(1-y^2) - y sqrt(1-x^2))`.
	</span>
	另外, 利用反射变换可以得到
	<span class="formula">
		`arcsin x + arcsin y = arcsin x - arcsin(-y)`,<br/>
		`arccos x + arccos y = arccos x - arccos(-y) + pi`,<br/>
		`arctan x + arctan y = arctan x - arctan(-y)`.
	</span>
</p>

<!-- 放在哪里好呢???
<p>	其中 `sgn x = {1, if x gt 0; 0, if x = 0; -1, if x lt 0 :}`.
	显然恒有 `x = sgn x |x|`, `x in RR`.
</p>
-->

<h2>双曲三角函数与反双曲三角函数</h2>

<h4>和角</h4>

<span class="formula">
	`sinh(x+-y) = sinh x cosh y +- sinh y cosh x`;<br/>
	`cosh(x+-y) = cosh x cosh y +- sinh x sinh y`;<br/>
	`tanh(x+-y) = (tanh x +- tanh y)/(1+-tanh x tanh y)`.
</span>

<h4>倍角公式</h4>

<span class="formula">
	`sinh 2x = 2 sinh x cosh x`;<br/>
	`cosh 2x = cosh^2 x + sinh^2 x` `= 2 cosh^2 x -1` `= 2 sinh^2 x +1`.
</span>

<h4>勾股定理</h4>

<span class="formula">
	`cosh^2 x = sinh^2 x + 1`;<br/>
	`1 = tanh^2 x + 1//cosh^2 x`;<br/>
	`1//tanh^2 x = 1 + 1//sinh^2 x`.
</span>

<h4>反双曲三角函数</h4>

<span class="formula">
	`"arsh "x = ln (x + sqrt(x^2+1))`, `quad x in RR`;<br/>
	`"arch "x = ln (x + sqrt(x^2-1))`, `quad x ge 1`;<br/>
	`"arth "x = 1/2 ln ((1+x)/(1-x))`, `quad -1 lt x lt 1`.
</span>

<h2>三角函数与复数</h2>

<h3>Euler 公式与 De Moivre 公式</h3>

<p class="theorem">
	<b>Euler 公式</b>
	<span class="formula">
		`"e"^("i"x) = cos x + "i" sin x`, `quad AA x in CC`.
	</span>
	从而
	<span class="formula">
		`cos x = ("e"^("i"x) + "e"^(-"i"x))/2`,
		`quad sin x = ("e"^("i"x) - "e"^(-"i"x))/{2"i"}`.
	</span>
	且
	<span class="formula">
		`arccos x = -"i" ln (x + "i"sqrt(1-x^2))`,<br/>
		`arcsin x = -"i" ln (sqrt(1-x^2) + "i"x)`,<br/>
		`arctan x = -"i" ln {:(1 + "i"x)/sqrt(1+x^2):}`.
	</span>
</p>

<p class="proof">
	比如, 设 `y = arccos x in (0, pi)`, 则 `sin y ge 0`, 有
	<span class="formula">
		`"e"^("i"y) = cos y + "i"sin y = x + "i"sqrt(1-x^2)`,
	</span>
	于是 `y = -"i"ln (x + "i"sqrt(1-x^2))`.
</p>

<p class="theorem">
	<b>De Moivre 公式</b>
	<span class="formula">
		`(cos x + "i"sin x)(cos y + "i"sin y)`
		`= cos(x+y) + "i"sin(x+y)`.
	</span>
	`AA n in ZZ`, 对 `n` 作归纳得到
	<span class="formula">
		`(cos x + "i"sin x)^n = cos nx + "i" sin nx`.
		<span class="label" id="for-de-moivre"></span>
	</span>
</p>

<h3>`n` 倍角公式与 Chebyshev 多项式</h3>

<p class="theorem">
	(Vieta) 将 <a class="ref" href="#for-de-moivre"></a>
	左边展开, 分别取实部和虚部就得到
	<span class="formula">
		`cos n x = sum_(j" even") (-1)^(j/2)
		(n;j) cos^(n-j) x sin^j x`,<br/>
		`sin n x = sum_(j" odd") (-1)^((j-1)/2)
		(n;j) cos^(n-j) x sin^j x`.
	</span>
</p>

<p class="theorem">
  <span class="formula">
    `sin n x = |
      sin x, 0;
      0, 2 cos x, 1;
      , 1, 2 cos x, 1;
      , , 1, ddots, 1;
      , , , 1, 2 cos x;
    |_n`,<br>
    `cos n x = |
      cos x, 1;
      1, 2 cos x, 1;
      , 1, 2 cos x, 1;
      , , 1, ddots, 1;
      , , , 1, 2 cos x;
    |_n`.
  </span>
</p>

<h3>`cos^n x` 和 `sin^n x` 的 Fourier 展开</h3>

<p> 利用 Euler 公式得到
	<span class="formula">
		`cos^n x = (("e"^("i"x)+"e"^(-"i"x))/2)^n`
		`= 2^-n sum_(k=0)^n (n;k) "e"^((n-2k)"i"x)`
		(取实部) `= 2^-n sum_(k=0)^n (n;k) cos (n-2k)x`,<br/>
		`sin^n x = (("e"^("i"x)-"e"^(-"i"x))/(2"i"))^n`
		`= 2^-n sum_(k=0)^n (n;k) "i"^(2k-n) "e"^((n-2k)"i"x)`
		`= {
			2^-n sum_(k=0)^n (n;k) (-1)^(k-m) cos (n-2k)x, n=2m;
			2^-n sum_(k=0)^n (n;k) (-1)^(k-m) sin (n-2k)x, n=2m+1;
		:}`
	</span>
	我们将这些重要公式列表如下 (分别用 `c_n`, `s_n` 表示 `cos n x`
	与 `sin n x`):
</p>

<table>
	<tr>
		<td>`n`</td>
		<td>`sin^n x`</td>
		<td>`cos^n x`</td>
	</tr>
	<tr>
		<td>`0`</td>
		<td>`c_0`</td>
		<td>`c_0`</td>
	</tr>
	<tr>
		<td>`1`</td>
		<td>`s_1`</td>
		<td>`c_1`</td>
	</tr>
	<tr>
		<td>`2`</td>
		<td>`(c_0 - c_2)//2`</td>
		<td>`(c_0 + c_2)//2`</td>
	</tr>
	<tr>
		<td>`3`</td>
		<td>`(3s_1 - s_3)//4`</td>
		<td>`(3c_1 + c_3)//4`</td>
	</tr>
	<tr>
		<td>`4`</td>
		<td>`(3c_0 - 4c_2 + c_4)//8`</td>
		<td>`(3c_0 + 4c_2 + c_4)//8`</td>
	</tr>
	<tr>
		<td>`5`</td>
		<td>`(10s_1 - 5s_3 + s_5)//16`</td>
		<td>`(10c_1 + 5c_3 + c_5)//16`</td>
	</tr>
</table>

<p> 容易看出每行的系数之和为 1. 系数三角形恰好是杨辉三角的右半边
	(中线上的数字要除以 2):
</p>

<pre>
&frac12;
   1
1     1
   3     1
3     4     1
  10     5     1
</pre>

<p> 利用这个结果可以轻松得出 `sin^n x`, `cos^n x` 的不定积分, 如
	<span class="formula">
		`int sin^5 x dx`
		`= 1/16 int (10 sin x - 5 sin 3 x + sin 5 x) dx`
		`= 1/16 (-10 cos x + 5/3 cos 3 x - 1/5 cos 5 x) + C`.
	</span>
</p>

<p class="remark">
	当然, 也可以按 Chebyshev 多项式的思路, 利用积化和差公式
	<span class="formula">
		`2 c_m c_n = c_(m+n) + c_|m-n|`,<br/>
		`2 s_m s_n = c_|m-n| - c_(m+n)`,<br/>
		`2 s_m c_n = s_(m+n) + sgn(m-n) s_|m-n|`
	</span>
	和初始条件
	<span class="formula">
		`cos^0 x = 1`, `cos^1 x = c_1`, `sin^0 x = 1`, `sin^1 x = s_1`
	</span>
	进行上述公式的推导.
</p>

<h2>杂例</h2>

<p class="example">
	计算 `1/(2sin 10^@) ( 3/(sin^2 40^@) - 1/(cos^2 40^@) )`.
</p>

<p class="solution">
	设 `x = 10^@`. 利用三倍角公式
	<span class="formula">
		` 1/2 = sin 3x`
		`= 3 cos^2 x sin x - sin^3 x`
		`= 3 sin x - 4 sin^3 x`.
	</span>
	消去 `sin^3 x` 后, 得到
	<span class="formula">
		`8 cos^2 x sin x = 2 sin x + 1`.
	</span>
	于是原式等于
	<span class="formula">
		`1/(2 sin x) ( 6/(1 - cos 8x) - 2/(1 + cos 8x) )`
		`= 1/sin x ( (3(1+sin x) - (1-sin x)) / ( 1-sin^2 x) )`
		`= (2(2sin x + 1)) / (sin x \ cos^2 x) = 16`.
	</span>
</p>

<p class="example">
	`prod_(n=1)^oo cos {:x/2^n:} = (sin x)/x`.
  特别取 `x = pi/2` 得到 Vieta 公式
  <span class="formula">
    `2/pi = sqrt(1/2) sqrt(1/2 + 1/2 sqrt(1/2))`
    `sqrt(1/2 + 1/2 sqrt(1/2 + 1/2 sqrt(1/2))) cdots`
  </span>
</p>

<ol class="example">
	计算
	<li>`arctan 1 + arctan{:1/2:} + arctan{:1/3:}`;</li>
	<li>`4 arctan{:1/5:} - arctan{:1/239:}`.</li>
</ol>

<ol class="solution">
	利用等式
	<span class="formula">
		`arctan x + arctan y = arctan{:(x+y)/(1-xy):}`,
		`quad x y lt 1`.
	</span>
	<li>
		<span class="formula">
			原式 `= arctan 1 + arctan{:(1/2 + 1/3)/(1- 1/2 *1/3 ):}`
			`= arctan 1 + arctan 1 = pi/2`.
		</span>
	</li>
	<li>
		<span class="formula">
			`2 arctan{:1/5:} = arctan{:(2/5)/(1-1/25):} =
			arctan{:5/12:}`,<br/>
			`4 arctan{:1/5:} = 2 arctan{:5/12:}`
			`= arctan{:(5/6)/(1-25/144):} = arctan{:120/119:}`,<br/>
			原式
			`= arctan{:(120/119-1/239)/(1+1/239 120/119):} = arctan 1`
			`= pi/4`.
		</span>
	</li>
</ol>

<p class="proof">
  2. 的另一证明, 使用复数, 由
  <span class="formula">
    `(5+"i")^4/(239+"i") = 2 (1+"i")`
  </span>
  立即结论.
</p>

<ol class="example">
	证明:
	<li>`2 arctan "e"^x - arctan sinh x = pi/2`;</li>
	<li>`2 arctan "e"^-x + arctan sinh x = pi/2`.</li>
</ol>

<p class="proof">
	只证第一式.
	注意到 `"e"^x * "e"^x lt 1` 未必成立, 不适合用公式
	<span class="formula">
		`arctan x + arctan y = arctan{:(x+y)/(1-x y):}`.
	</span>
	不过 `arctan" e"^x gt 0` 恒成立, 因此适合用 `"arccot"` 来刻画.
	<span class="formula">
		原式 `= "arccot"{:(1-"e"^(2x))/(2"e"^x):} - arctan sinh x`
		`= "arccot"(-sinh x) + arctan(-sinh x)`
		`= pi/2`.
	</span>
</p>

<p class="proof">
	只证第一式.  求导,
	<span class="formula">
		`2/(1+"e"^(2x)) "e"^x - 1/(1+sinh^2 x) cosh x`
		`= 1/(cosh x) - 1/(cosh x) = 0`.
	</span>
	从而原式恒为一常数. 取 `x = 0` 得 `pi/2`.
</p>

<ol class="example">
	证明
	<li>`2 arctan sqrt ((a-b)/(a+b))
		= arccos {: b/a :}`, `quad a ge |b|`;</li>
	<li>`arccos x = 2 arccos sqrt((1+x)/2) = 2 arcsin sqrt((1-x)/2)`.</li>
</ol>

<ol class="proof">
	<li>原式 `= arctan{:(2sqrt((a-b)/(a+b)))/(1-(a-b)/(a+b)):}`
		`= arctan{:(sqrt(a^2-b^2))/b:}`
		`= sgn b * arccos{:b/a:}`.
	</li>
</ol>

<p class="example">
  求 `sum_(n ge 1) arctan{:2/n^2:}`.
</p>

<p class="solution">
  注意到 `arctan{:2/n^2:} = arctan(n+1) - arctan(n-1)`, 故原式等于
  `lim_(n to oo) (arctan(n+1) + arctan n - arctan 1 - arctan 0) = 3/4 pi`.
</p>

<p class="example">
	解方程 `(sin x)/(sin(40^@-x)) = 4cos 20^@ cos 40^@`,
	`0 lt x lt 40^@`.
</p>

<p class="solution">
	预处理方程右边,
	<span class="formula">
		`4 (sin 20^@)/(sin 20^@) cos 20^@ cos 40^@`
		`= 2/(sin 20^@) sin 40^@ cos 40^@`
		`= (sin 80^@)/(sin 20^@)`
		`= (cos 10^@)/(sin 20^@)`
		`= 1/(2 sin 10^@)`.
	</span>
	方程化为
	<span class="formula">
		`(sin x)/(sin(40^@-x)) = 1/(2 sin 10^@)`,<br/>
		`2 sin 10^@ sin x = sin 40^@ cos x - cos 40^@ sin x`,<br/>
	</span>
	从而
	<span class="formula">
		`tan x = (sin 40^@)/(2 sin 10^@ + cos 40^@)`
		`= (sin(30^@+10^@))/(2 sin 10^@ + cos(30^@+10^@))`
		`= (1/2 cos 10^@ + (sqrt 3)/2 sin 10^@)/(2 sin 10^@ + (sqrt 3)/2
		cos 10^@ - 1/2 sin 10^@)`
		`= 1/sqrt(3)`.
	</span>
	因此 `x = 30^@`.
</p>

<p class="example">
	已知 `sin(2x+30^@) = 4/5`, `0 lt x lt 45^@`, 求 `13/(cos 3x)`.
</p>

<p class="solution">
	使用万能代换. 设 `t = tan x`, 代入条件, 解二次方程得 `t
	= (5sqrt3-6)/13`.
	从而
	<span class="formula">
		`13/(cos 3x) = 13/(cos x(4cos^2 x-3))`
		`= 13 (1+t^2)^(3/2)/(1-3t^2)`
		`= 5 sqrt 10`.
	</span>
</p>

<p class="example">
	求函数 `y = (sin x - 1)/(cos x - 2)` 的值域.
</p>

<p class="solution">
	通用做法:
	作万能代换 `t = tan{:x/2:}`, 则
	<span class="formula">
		`sin x = (2t)/(1+t^2)`, `quad cos x = (1-t^2)/(1+t^2)`,<br/>
		`y = (2t - (1+t^2))/(1-t^2 -2(1+t^2))`
		`= (t^2-2t+1)/(3t^2+1)`
		`= 1/3 - (2t-2/3)/(3t^2+1)`.
	</span>
	令 `u = 2t-2/3`,
	<span class="formula">
		`y = 1/3 - u/(3/4 u^2 + u + 4/3)`
		`= 1/3 - 1/(1 + (3u)/4 + 4/(3u))`.
	</span>
	从而
	<span class="formula">
		`|(3u)/4 + 4/(3u)| ge 2`,<br/>
		`1 + (3u)/4 + 4/(3u) in (-oo, -1] uu [3, +oo)`,<br/>
		`-1/(1+(3u)/4 + 4/(3u)) in [-1/3, 1]`,<br/>
		`y in [0, 4/3]`.
	</span>
</p>

<p class="solution">
	变形得
	<span class="formula">
		`y cos x - sin x = 2y - 1`.
	</span>
	引入辅助角 `theta`, 满足
	<span class="formula">
		`cos theta = y/sqrt(1+y^2)`, `quad sin theta = 1/sqrt(1+y^2)`,
	</span>
	于是
	<span class="formula">
		`(2y-1)/sqrt(1+y^2) = cos(x + theta) in [-1, 1]`.
	</span>
	解不等式
	<span class="formula">
		`(2y-1)^2 le 1 + y^2`
	</span>
	得 `y in [0, 4/3]`.
</p>

<p class="solution">
	联系几何意义, 原问题即求平面上点 (2,1) 到单位圆上一点连线的斜率范围.
	这只需作出 (2,1) 到单位圆的切线.
	从图像容易看出其中一条切线的斜率是 0, 另一切线的斜率等于
	<span class="formula">
		`tan(2arctan{:1/2:})`
		`= (2 * 1/2)/(1- (1/2)^2)`
		`= 4/3`.
	</span>
</p>

<p class="example">
    设 `theta = pi/7`, `a = sin(-theta)`, `b = sin 2theta`, `c = sin
    3theta`, 证明:
    <span class="formula">
        `a/b^2 + b/c^2 + c/a^2 = 2 sqrt 7`.
    </span>
</p>

<ol class="proof">
    简记 `sin n theta = s_n`, `cos n theta = c_n`.
    <li>我们来证明 `a, b, c` 的基本对称多项式
        <span class="formula">
            `sigma_1 = a + b + c = (sqrt 7)/2`,
            `quad sigma_2 = a b+b c+c a = 0`,
            `quad sigma_3 = a b c = -(sqrt 7)/8`.
        </span>
        首先由<a class="ref" href="#the-sin-prod"></a>有
        `(a b c)^2 = 7//2^6`, 故 `a b c = -sqrt 7 // 8`.
    </li>
    <li>求 `sigma_2`, 先证 `a^2 - b^2 = c a`.
        <span class="formula">
            `s_1^2 - s_2^2`
            `= (1-c_2)/2 - (1-c_4)/2`
            `= 1/2 (c_4 - c_2)`
            `= -s_3 s_1`.
        </span>
        类似可证 `b^2 - c^2 = a b`, `c^2 - a^2 = b c`. 三式相加即得
        `sigma_2 = 0`.
    </li>
    <li>求 `sigma_1`.
        <span class="formula">
            `a + b + c`
            `= -s_1 + s_2 + s_3`
            `= -s_1 + s_2 + (c_2 s_1 + c_1 s_2)`
            `= s_2(1+c_1) - s_1(1-c_2)`
            `= 2(s_2 s_3^2 - s_1^3)`
            `= 2(b c^2 + a^3)`
            `= 2(b c^2 + a(c^2-b c))`
            `= 2(b c^2 + a c^2) - 2 a b c`
            `= 2c(b c + a c) - 2 a b c`
            `= 2c(-a b) - 2 a b c`
            `= -4 a b c = sqrt 7//2`.
        </span>
    </li>
    <li>证 `4 a^2 b = 2 b - c`.
        <span class="formula">
            `4 s_1^2 s_2`
            `= 2 s_2 (1-c_2)`
            `= 2 s_2 - s_4`
            `= 2 s_2 - s_3`.
        </span>
        类似有 `4 b^2 c = 2 c - a`, `4 c^2 a = 2 a - b`.
    </li>
    <li>来证最终结论, 即证
        <span class="formula">
            `a^2 b^3 + b^2 c^3 - c^2 a^3 = 2 sqrt 7 (a b c)^2`
            `= 2 sqrt 7 sigma_3^2 = (7sqrt 7)/32`.
        </span>
        左边的 4 倍等于
        <span class="formula">
            `b^2 (2 b-c) + c^2 (2 c-a) + a^2 (2 a-b)`
            `= 2(a^3 + b^3 + c^2) - (b^2 c + c^2 a + a^2 b)`
            `= 2(a^3 + b^3 + c^2) - 1/4(a+b+c)`.
        </span>
        由 Newton 公式,
        <span class="formula">
            `S_1 = a + b + c`
            `= sigma_1 = (sqrt 7)/2`,<br/>
            `S_2 = a^2 + b^2 + c^2`
            `= sigma_1 S_1 - 2 sigma_2 = 7/4`,<br/>
            `S_3 = a^3 + b^3 + c^3`
            `= sigma_1 S_2 - sigma_2 S_1 + 3 sigma_3 = (sqrt 7)/2`.
        </span>
        从而 `2 S_3 - 1/4 S_1 = (7sqrt 7)/8`.
        证毕.
    </li>
</ol>

<p class="example">
  在三角形 `A B C` 中, 已知 `(sin B-sin C)^2 = sin A^2 - sin B sin C`,
  求角 `A`.
</p>

<p class="solution">
  先用正弦定理得 `(b-c)^2 = a^2 - b c`, 即
  <span class="formula">
    `b c = b^2+c^2-a^2`,
  </span>
  再用余弦定理
  <span class="formula">
    `cos A = (b^2+c^2-a^2)/(2b c) = 1/2`,
  </span>
  即 `A = pi//3`.
</p>

<p class="example">
  在锐角三角形 `A B C` 中, 已知 `cos^2 A + cos^2 B - cos A cos B = 3/4`,
  求角 `C`.
</p>

<p class="solution">
  设 `x, y, z = cos A, cos B, cos C`, 将已知条件与恒等式联立:
  <span class="formula">
  `{
    x^2 + y^2 - x y = 3/4;
    x^2 + y^2 + z^2 + 2 x y z = 1
  :}`
  </span>
  解得 `x y = (1-2 z)//4`, `x^2 + y^2 = 1 - z // 2`. 于是
  <span class="formula">
    `z = sqrt(1-x^2)sqrt(1-y^2) - x y`
    `= sqrt(1-x^2 y^2 - (3/4 + x y)) - x y`,
  </span>
  代入 `x y = (1-2 z)//4` 解得 `z = 1/2`, 即 `C = pi//3`.
</p>

<p class="example">
  [来自 我是费马的最后一页空白] 求
  <span class="formula">
    `1/(sin 45^@ sin 46^@) + 1/(sin 47^@ + sin 48^@) + cdots`
    `+ 1/(sin 133^@ + sin 134^@)`.
  </span>
</p>

<p class="solution">
  注意到
  <span class="formula">
    `sin 1^@/(sin n^@ sin(n+1)^@)`
    `= (cos n^@)/(sin n^@) - (cos(n+1)^@)/(sin(n+1)^@)`,
  </span>
  因此原式等于
  <span class="formula">
    `1/(sin 1^@) (cot 45^@ - cot 46^@ + cdots + cot 133^@ - cot 134^@)`
    `= (cot 45^@)/(sin 1^@)`
    `= 1/(sin 1^@)`.
  </span>
</p>

<p class="example">
  [来自 我是笨蛋的Always] 求 `f = cos x cos y + 2 cos x sin y + 2 sin x`
  的最值.
</p>

<p class="solution">
  求偏导
  <span class="formula">
    `f_x = -sin x(cos y + 2 sin y) + 2 cos x`,<br>
    `f_y = cos x(2 cos y - sin y)`.
  </span>
  令 `f_x = f_y = 0`, 得
  <span class="formula">
    `{cos x = 0; cos y = -2 sin y:}` 或
    `{2cos y = sin y; cos y = 2/5 cot x:}`.
  </span>
  第一种情况下 `f = +-2`, 第二种情况 `tan y = 2`, `cos y = +- 1/sqrt5`,
  等等, 化简得 `f = +-3`. 因此 `f` 的最值是 `+-3`.
</p>

<script src="../../js/note.js?type=math"></script>
</body>
</html>
