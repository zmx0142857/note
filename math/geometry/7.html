<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <title>çƒé¢å‡ ä½•</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="../../css/note.css" />
  <style>
    body .ui-range-label {
      width: 80px;
    }
  </style>
</head>
<body>

<p>[æ¥è‡ª <a href="https://zhuanlan.zhihu.com/p/97346034" target="_blank">yangqiao@çŸ¥ä¹</a>]</p>

<p class="remark">
  çƒé¢å‡ ä½•åœ¨å¤§åœ°æµ‹é‡å­¦ä¸­æœ‰å¹¿æ³›åº”ç”¨. æ•°å­¦ä¸Š, å®ƒå¯ä»¥ä½œä¸ºéæ¬§å‡ ä½•çš„ä¸€ä¸ªå¾ˆå¥½çš„å…¥é—¨,
  äº¦å¯ä»¥ç”¨ä½œå¾®åˆ†å‡ ä½•ä¸é»æ›¼å‡ ä½•çš„å…ˆè¡Œè¯¾ç¨‹.
</p>

<h2>åŸºæœ¬æ¦‚å¿µ</h2>

<ol class="definition">
  <li>è¿‡çƒå¿ƒçš„å¹³é¢ä¸çƒé¢çš„äº¤çº¿å«åš<b>å¤§åœ†</b>; ä¸è¿‡çƒå¿ƒçš„å¹³é¢ä¸çƒé¢çš„äº¤çº¿ (å¦‚æœå­˜åœ¨) å«<b>å°åœ†</b>.
  </li>
  <li>è¿‡çƒé¢ä¸Šä»»æ„ä¸¤ç‚¹å¯åšä¸€ä¸ªå¤§åœ†:
    å½“è¿™ä¸¤ç‚¹ä½äºä¸€æ¡ç›´å¾„çš„ä¸¤ç«¯æ—¶, å¯åšæ— æ•°ä¸ªå¤§åœ†, å¦åˆ™åªèƒ½åšä¸€ä¸ª.
    å¤§åœ†ä½äºä¸¤ç‚¹ä¹‹é—´çš„éƒ¨åˆ†å«åš<b>å¤§åœ†å¼§</b>.
  </li>
  <li>
    çƒé¢ä¸Šä¸¤ä¸ªå¤§åœ†æ€»æ˜¯ç›¸äº¤äºä¸¤ç‚¹, è¿™ä¸¤ç‚¹ä½äºä¸€æ¡ç›´å¾„çš„ä¸¤ç«¯.
    ä¸¤ä¸ªå¤§åœ†äº¤ç‚¹å¤„çš„åˆ‡çº¿å¤¹è§’å«åš<b>çƒé¢è§’</b>.
  </li>
  <li>çƒé¢ä¸Šçš„ä¸‰ä¸ªç‚¹ç”¨å¤§åœ†å¼§ç›¸è¿, å›´æˆçš„å›¾å½¢å«åš<b>çƒé¢ä¸‰è§’å½¢</b>.
    ä¸‰ä¸ªçƒé¢è§’å«åšçƒé¢ä¸‰è§’å½¢çš„è§’, ç”¨å¤§å†™å­—æ¯ `A, B, C`è¡¨ç¤º;
    ä¸‰ä¸ªå¤§åœ†å¼§å«åšçƒé¢ä¸‰è§’å½¢çš„è¾¹, ç”¨å°å†™å­—æ¯ `a, b, c` è¡¨ç¤º.
    æ³¨æ„ `a, b, c` é€šå¸¸è§†ä½œè§’åº¦è€Œä¸æ˜¯å¼§é•¿.
  </li>
</ol>

<p class="remark">
  å¤§åœ†æ˜¯çƒé¢ä¸Šçš„æµ‹åœ°çº¿, å¯ç±»æ¯”äºå¹³é¢ä¸Šçš„ç›´çº¿.
</p>

<h2>è¾¹è§’çš„åŸºæœ¬æ€§è´¨</h2>

<p class="definition">
  è¿‡çƒå¿ƒ, ä½œå¤§åœ†æ‰€åœ¨å¹³é¢çš„å‚çº¿, ä¸çƒé¢äº¤äºä¸¤ç‚¹, ç§°ä¸ºå¤§åœ†çš„<b>æ</b>.
  å¦‚æœ `A', B', C'` åˆ†åˆ«æ˜¯çƒé¢ä¸‰è§’å½¢ `ABC` ä¸‰è¾¹çš„æ, åˆ™ `A'B'C'` ç§°ä¸º `ABC` çš„<b>æä¸‰è§’å½¢</b>.
</p>

<ol class="lemma">
  <li>è‹¥ `A'B'C'` æ˜¯ `ABC` çš„æä¸‰è§’å½¢, åˆ™ `ABC` ä¹Ÿæ˜¯ `A'B'C'` çš„æä¸‰è§’å½¢.</li>
  <li>æä¸‰è§’å½¢çš„è¾¹ä¸åŸä¸‰è§’å½¢çš„å¯¹åº”è§’äº’è¡¥ï¼Œè§’ä¸åŸä¸‰è§’å½¢çš„å¯¹åº”è¾¹äº’è¡¥.</li>
  <div class="img md">
    <img src="../img/sphere-triangle-01.svg" alt="">
  </div>
</ol>

<ol class="proof">
  <li>
    ç”± `B'` æ˜¯ `arc(AC)` çš„æ, æœ‰ `arc(B'A) = pi//2`.
    ç”± `C'` æ˜¯ `arc(AB)` çš„æ, æœ‰ `arc(C'A) = pi//2`.
    ç”±ç«‹ä½“å‡ ä½•çŸ¥, `AO` å‚ç›´äº `B'C'` æ‰€åœ¨çš„å¹³é¢, å³ `A` æ˜¯ `B'C'` çš„æ.
  </li>
  <li>
    è®¾ `arc(B'C')` äº¤ `arc(AB)` äº `D`, äº¤ `arc(AC)` äº `E`.
    å› ä¸º `B'` æ˜¯ `b` çš„æ, `C'` æ˜¯ `c` çš„æ, æ‰€ä»¥ `arc(B'E) = arc(C'D) = pi//2`.
    ä»è€Œ
    <span class="formula">
      `arc(B'C') + arc(DE)`
      `= arc(B'E) + arc(C'D) = pi`.
    </span>
    ç”± 1. çŸ¥ `A` æ˜¯ `arc(B'C')` çš„æ, æ•… `arc(DE) = A`, æ­¤ä¸ `arc(B'C') = a'` ä¸€èµ·ä»£å…¥ä¸Šå¼æœ‰
    `a' + A = pi`.
  </li>
</ol>

<p class="theorem">
  çƒé¢ä¸‰è§’å½¢ä¸¤è¾¹ä¹‹å’Œå¤§äºç¬¬ä¸‰è¾¹.
</p>

<p class="proof">
  å°†çƒé¢ä¸‰è§’å½¢ `ABC` çš„é¡¶ç‚¹ä¸çƒå¿ƒ `O` è¿æ¥, ç”±ç«‹ä½“å‡ ä½•çŸ¥: ä¸‰é¢è§’çš„ä¸¤ä¸ªé¢è§’ä¹‹å’Œå¤§äºç¬¬ä¸‰ä¸ªé¢è§’,
  ä»è€Œçƒé¢ä¸‰è§’å½¢ä¸¤è¾¹ä¹‹å’Œå¤§äºç¬¬ä¸‰è¾¹.
</p>

<ol class="theorem">
  <li>çƒé¢ä¸‰è§’å½¢ä¸‰è¾¹ä¹‹å’Œçš„èŒƒå›´: `(0, 2pi)`.</li>
  <li>çƒé¢ä¸‰è§’å½¢ä¸‰è§’ä¹‹å’Œçš„èŒƒå›´: `(pi, 3pi)`.</li>
</ol>

<ol class="proof">
  <li>
    å› ä¸º `a, b, c` å‡ä¸ºæ­£, æ‰€ä»¥å’Œå¤§äº 0. åˆç”±ç«‹ä½“å‡ ä½•çŸ¥å‡¸å¤šé¢è§’å„é¢è§’ä¹‹å’Œå°äº `2pi`, æ‰€ä»¥å’Œå°äº `2pi`.
  </li>
  <li>
    ç”±æä¸‰è§’å½¢å’ŒåŸä¸‰è§’å½¢çš„å…³ç³»å¾—: `a' + A = pi`,
    ä»è€Œ `A+B+C = 3pi - (a' + b' + c')`. å†ç”± 1. å³å¾—åˆ°ç»“è®º.
  </li>
</ol>

<p class="theorem">
  çƒé¢ä¸‰è§’å½¢ä¸­: ç­‰è§’å¯¹ç­‰è¾¹, ç­‰è¾¹å¯¹ç­‰è§’; å¤§è§’å¯¹å¤§è¾¹, å¤§è¾¹å¯¹å¤§è§’.
</p>

<h2>å…­ä¸ªåŸºæœ¬å…¬å¼</h2>

<div class="theorem p">
  <b>è¾¹çš„ä½™å¼¦å…¬å¼</b> `cos a = cos b cos c + sin b sin c cos A`.<br>
  <b>è§’çš„ä½™å¼¦å…¬å¼</b> `cos A = - cos B cos C + sin B sin C cos a`.
  <div class="img md">
    <img src="../img/sphere-triangle-cos.svg" alt="">
  </div>
</div>

<p class="proof">
  è¿‡ç‚¹ `A` åš `b, c` çš„åˆ‡çº¿, åˆ†åˆ«äº¤ `OB`, `OC` çš„å»¶é•¿çº¿äº `M`, `N`.
  åœ¨å¹³é¢ä¸‰è§’å½¢ `OMN`, `AMN` ä¸­, åˆ†åˆ«ç”±ä½™å¼¦å®šç†å¾—
  <span class="formula">
    `MN^2 = OM^2 + ON^2 - 2 OM * ON * cos a`,<br>
    `MN^2 = AM^2 + AN^2 - 2 AM * AN * cos A`.
  </span>
  å°†ç¬¬äºŒå¼ä»£å…¥ç¬¬ä¸€å¼å¾—åˆ°
  <span class="formula align">
    `2OM * ON * cos a`<br>
    `= (OM^2 - AM^2) + (ON^2 - AN^2) + 2 AM * AN * cos A`<br>
    `= 2 OA^2 + 2AM * AN * cos A`.
  </span>
  äºæ˜¯
  <span class="formula">
    `cos a = (OA)/(OM) * (OA)/(ON) + (AM)/(OM) * (AN)/(ON) * cos A`
    `= cos c cos b + sin c sin b cos A`.
  </span>
  åˆ©ç”¨æä¸‰è§’å½¢ä¸åŸä¸‰è§’å½¢çš„å…³ç³», å°†ä¸Šå¼çš„ `a` æ¢æˆ `pi - A`, `A` æ¢æˆ `pi - a`,
  ä¾æ­¤ç±»æ¨; å°±å¾—åˆ°è§’çš„ä½™å¼¦å…¬å¼.
</p>

<p class="theorem">
  <b>æ­£å¼¦å…¬å¼</b> `(sin a)/(sin A) = (sin b)/(sin B) = (sin c)/(sin C)`.
  <div class="img md">
    <img src="../img/sphere-triangle-sin.svg" alt="">
  </div>
</p>

<p class="proof">
  è¿‡ç‚¹ `C` ä½œå¹³é¢ `OAB` çš„å‚çº¿, å‚è¶³ä¸º `D`, å†ä» `D` å‘ `OA`, `OB` ä½œå‚çº¿, å‚è¶³åˆ†åˆ«ä¸º `E, F`.
  æ˜“çŸ¥ `OA` ä¸å¹³é¢ `CDE` å‚ç›´, `OB` ä¸å¹³é¢ `CDF` å‚ç›´, å› æ­¤ `/_ CED = A`, `/_ CFD = B`.
  ç”±å›¾çŸ¥
  <span class="formula">
    `(sin a)/(sin A) = (CF//OC)/(CD//CE)`,<br>
    `(sin b)/(sin B) = (CE//OC)/(CD//CF)`.
  </span>
  å› æ­¤ `(sin a)/(sin A) = (sin b)/(sin B)`.
</p>

<ol class="theorem">
  <li>
    <b>äº”å…ƒç´ å…¬å¼ (1)</b> `sin a cos B = cos b sin c - sin b cos c cos A`.<br>
    <b>äº”å…ƒç´ å…¬å¼ (2)</b> `sin A cos b = cos B sin C + sin B cos C cos a`.
  </li>
  <li>
    <b>å››å…ƒç´ å…¬å¼</b> `sin A cot B = sin c cot b - cos c cos A`.
  </li>
</ol>

<ol class="proof">
  <li>
    ç”±è¾¹çš„ä½™å¼¦å…¬å¼,
    <span class="formula">
      `cos a = cos b cos c + sin b sin c cos A`,<br>
      `cos b = cos c cos a + sin c sin a cos B`.
    </span>
    å°†ç¬¬ä¸€å¼ä»£å…¥ç¬¬äºŒå¼å¾—åˆ°
    <span class="formula align">
      `sin c sin a cos B`<br>
      `= cos b - cos c (cos b cos c + sin b sin c cos A)`<br>
      `= cos b - cos b cos^2 c - sin b sin c cos c cos A`<br>
      `= cos b sin^2 c - sin b sin c cos c cos A`.
    </span>
    ä¸¤è¾¹åŒé™¤ä»¥ `sin c` å³å¾—å…¬å¼ (1).
    å†åˆ©ç”¨æä¸‰è§’å½¢ä¸åŸä¸‰è§’å½¢çš„å…³ç³»å¾—åˆ°å…¬å¼ (2).
  </li>
  <li>
    åˆ©ç”¨æ­£å¼¦å…¬å¼, åœ¨äº”å…ƒç´ å…¬å¼ (1) å·¦è¾¹ä¹˜ä»¥ `(sin A)/(sin a sin B)`,
    å³è¾¹ä¹˜ä»¥ `1/(sin b)` å³å¾—ç»“è®º.
  </li>
</ol>

<h2>çƒé¢ä¸‰è§’çš„é¢ç§¯</h2>

<p class="theorem">
  <b>Gauss-Bonnet å…¬å¼</b>
  çƒé¢ä¸‰è§’å½¢çš„é¢ç§¯ `S = R^2(A + B + C - pi)`.
  å…¶ä¸­ `R` æ˜¯çƒçš„åŠå¾„, `A, B, C` æ˜¯ä¸‰ä¸ªçƒé¢è§’.
</p>

<p class="example">
  çƒé¢ä¸‰è§’å½¢ä¸‰ä¸ªè§’éƒ½æ˜¯ 90 åº¦æ—¶, ç”¨ Gauss-Bonnet å…¬å¼æ±‚å¾—é¢ç§¯ä¸º `pi R^2 //2`, æ°å¥½æ˜¯çƒé¢çš„ `1//8`.
</p>

<h2>æ‚ä¾‹</h2>

<p class="example">
  å·²çŸ¥çƒé¢ä¸Šä¸¤ç‚¹çš„ç»çº¬åº¦æ±‚å¼§é•¿.
</p>

<p class="solution">
  è®¾å®ƒä»¬çš„ç»çº¬åº¦æ˜¯ `(theta_1, varphi_1)`, `(theta_2, varphi_2)`, åŒ–ä¸ºç›´è§’åæ ‡:
  <span class="formula">
    `x = R cos varphi cos theta`,<br>
    `y = R cos varphi sin theta`,<br>
    `z = R sin varphi`.
  </span>
  æ±‚çƒå¿ƒåˆ°ä¸¤ä¸ªç‚¹çš„å‘é‡ `bm r_1, bm r_2` å¤¹è§’
  <span class="formula align">
    `cos alpha = cos varphi_1 cos varphi_2 (cos theta_1 cos theta_2 + sin theta_1 sin theta_2)`
    `+ sin varphi_1 sin varphi_2`<br>
    `= cos varphi_1 cos varphi_2 cos(theta_1 - theta_2) + sin varphi_1 sin varphi_2`<br>
    `= cos(varphi_1 - varphi_2) - cos varphi_1 cos varphi_2(1 - cos(theta_1 - theta_2))`.<br>
  </span>
  è€Œå¼§é•¿ç­‰äº `R alpha`.
</p>

<p class="example">
  å·²çŸ¥çƒé¢ä¸Šä¸‰ç‚¹çš„ç»çº¬åº¦æ±‚çƒé¢è§’ `ABC`.
</p>

<p class="example">
  çƒé¢ä¸Šä¸¤ç‚¹é—´çš„å¤§åœ†å¼§çš„è½¨è¿¹æ–¹ç¨‹.
</p>

<p class="solution">
  çƒå¿ƒåˆ°è¿™ä¸¤ä¸ªç‚¹çš„å‘é‡ä¸º `bm r_1, bm r_2`.
  å•ä½æ³•å‘é‡ä¸º `bm n = (bm r_1 xx bm r_2) / |bm r_1 xx bm r_2|`. è®¾ `bm r` æ˜¯ `bm r_1` ç»• `bm n` æ—‹è½¬ `alpha` è§’æ‰€å¾—çš„å‘é‡,
  ç”±<a href="../analytic-geo/1.html">ä¸‰ç»´æ—‹è½¬å…¬å¼ (çŸ©é˜µå½¢å¼)</a> æœ‰ `bm r = bm T bm r_1`, å…¶ä¸­
  <span class="formula">
    `bm T = (1 - cos alpha) bm n bm n^(sf T) + cos alpha bm I + sin alpha`
    `[0, -n_z, n_y; n_z, 0, -n_x; -n_y, n_x, 0]`.
  </span>
  æ­¤å³å…³äº `alpha` çš„ä¸€ä¸ªå‚æ•°æ–¹ç¨‹. é€šè¿‡åå˜æ¢
  <span class="formula">
    `theta = arctan(y//x)`,<br>
    `varphi = arcsin(z//R)`
  </span>
  å³å¾—åˆ°å…³äº `(theta, varphi)` çš„å‚æ•°æ–¹ç¨‹.
</p>

<div class="img" title="å¤§åœ†å¼§çš„å¯è§†åŒ– (Mercator æŠ•å½±)">
  <canvas id="img-arc-lonlat" width="600" height="600"></canvas>
  <div>
    <span id="img-arc-range-lon1"></span>
    <span id="img-arc-range-lat1"></span>
  </div>
  <div>
    <span id="img-arc-range-lon2"></span>
    <span id="img-arc-range-lat2"></span>
  </div>
</div>

<p class="example">
  <b>å¢¨å¡æ‰˜æŠ•å½± (Mercator Projection)</b>
  å‡è®¾åœ°çƒæ˜¯æ­£çƒä½“, çƒå¿ƒå¤„çš„å…‰æºå°†çƒé¢ä¸Šçš„ç‚¹æŠ•å½±åˆ°å¤–åˆ‡åœ†æŸ±é¢ä¸Š, å†æŠŠåœ†æŸ±å±•å¼€, å°±å¾—åˆ°åœ°çƒçš„å¢¨å¡æ‰˜æŠ•å½±.
  å¢¨å¡æ‰˜æŠ•å½±ä¸é€‚åˆé«˜çº¬åº¦åœ°åŒº, å› ä¸ºé«˜çº¬åœ°åŒºçš„å›¾å½¢ç•¸å˜è¿‡å¤§. ç‰¹åˆ«åœ°,
  å—åŒ—æç‚¹è¢«æŠ•å½±åˆ°æ— ç©·è¿œå¤„, åœ¨åœ°å›¾ä¸Šæ— æ³•æ˜¾ç¤º.
  å¢¨å¡æ‰˜æŠ•å½±çš„é‡è¦æ€§è´¨æ˜¯<b>ç­‰è§’æ€§</b>.
</p>

<p class="example">
  wgs84 æ ‡å‡†å‡è®¾åœ°çƒæ˜¯ä¸€ä¸ªæ¤­çƒä½“, æ–¹ç¨‹ä¸º
  <span class="formula">
    `(x^2+y^2)/a^2 + z^2/b^2 = 1`.
  </span>
  å…¶ä¸­ `a = 6378137"m"`, `b = 6356752.31424518"m"`,
  å·²çŸ¥åœ°çƒä¸Šä¸€ç‚¹ `P` çš„ç»çº¬åº¦å’Œé«˜åº¦ `(theta, varphi, h)`, æ±‚è¿™ç‚¹çš„åæ ‡.
</p>

<ol class="solution">
  <li>
    è¿™ä¸ªé—®é¢˜çš„é‡ç‚¹æ˜¯å¾—åˆ° `P` ç‚¹å¤„çš„ã€Œå¯é…‰åœˆã€æ›²ç‡åŠå¾„
    <span class="formula">
      `n = a^2/sqrt(a^2 cos^2 varphi + b^2 sin^2 varphi)`.
      <span class="label">`(**)`</span>
    </span>
    äºæ˜¯è¿™ç‚¹çš„åæ ‡æ˜¯
    <span class="formula">
      `x = (n + h) cos varphi cos theta`,<br>
      `y = (n + h) cos varphi sin theta`,<br>
      `z = (n * b^2/a^2 + h) sin varphi`.
    </span>
    `z` çš„æ±‚æ³•æ˜¯, å…ˆå‡è®¾ `h = 0`, å†æŠŠ `x, y` ä»£å…¥æ¤­çƒé¢æ–¹ç¨‹æ±‚è§£.
  </li>
  <li>
    æˆ‘ä»¬æ¥å¯¼å‡º `P` ç‚¹å¤„çš„æ›²ç‡åŠå¾„å…¬å¼ `(**)`.
    å–å®šæ¤­çƒé¢çš„å‚æ•°æ–¹ç¨‹
    <span class="formula">
      `bm r = (a cos u cos v, a cos u sin v, b sin u)`,<br>
      `bm r_u = (-a sin u cos v, -a sin u sin v, b cos u)`,<br>
      `bm r_v = (-a cos u sin v, a cos u cos v, 0)`.
    </span>
    ä½¿ç”¨æ—‹è½¬æ›²é¢çš„å…¬å¼å¾—åˆ°
    <span class="formula">
      `E = a^2 sin^2 u + b^2 cos^2 u`,
      `quad L = a b//sqrt E`,
      `quad N = a b cos^2 u // sqrt E`.
    </span>
    ç”±å¯¹ç§°æ€§, æˆ‘ä»¬å¯ä»¥ä»»å–ä¸€ä¸ªå­åˆé¢ (æ¤­çƒè¿‡ z è½´çš„æˆªé¢), å¦‚ `xOz` å¹³é¢, è€ƒè™‘æ¤­çƒé¢ä¸Šä¸€ç‚¹
    `P(x_0, 0, z_0)`.
    <div class="img md">
      <img src="../img/wgs84-ellipsoid.png">
    </div>
    æ³¨æ„, æ¤­çƒé¢ä¸Šè¿‡ `P` ç‚¹æœ‰æ— æ•°ä¸ªå•ä½åˆ‡å‘é‡, æ¯ä¸€ä¸ªåˆ‡å‘é‡éƒ½ç¡®å®šäº† `P` å¤„çš„ä¸€ä¸ªæ›²ç‡.
    æˆ‘ä»¬è¦æ±‚çš„æ›²ç‡æ˜¯ã€Œå¯é…‰åœˆã€åœ¨ `P` å¤„çš„æ›²ç‡, å³ `P` ç‚¹å¤„å‚ç›´äºå­åˆé¢çš„å•ä½åˆ‡å‘é‡æ‰€ç¡®å®šçš„æ›²ç‡.
    æ˜¾ç„¶, åœ¨æˆ‘ä»¬çš„å‡å®šä¸‹, è¿™ä¸ªåˆ‡å‘é‡å°±æ˜¯ `bm v = (0, 1, 0)`.
    åœ¨ `P` å¤„, å‚æ•° `v = 0`, å‚æ•° `u` æ»¡è¶³ `a cos u = x_0`, äºæ˜¯åˆ‡å‘é‡ `bm r_u, bm r_v` ç­‰äº
    <span class="formula">
      `bm r_u = (-a sin u, 0, b cos u)`,
      `quad bm r_v = (0, x_0, 0)`.
    </span>
    å°† `v` åˆ†è§£ä¸º `bm r_u, bm r_v` çš„çº¿æ€§ç»„åˆ:
    <span class="formula">
      `bm v = 0 bm r_u + 1/x_0 bm r_v`.
    </span>
    åˆ™ `P` å¤„æ²¿ `bm v` çš„æ³•æ›²ç‡ç­‰äº
    <span class="formula">
      `k_n(bm v) = 0^2 L + 1/x_0^2 N`
      `= b/a 1/sqrt(a^2 sin^2 u + b^2 cos^2 u)`
      `= 1/(a/b sqrt(a^2/b^2 z_0^2 + b^2/a^2 x_0^2))`
      `= 1/sqrt(x_0^2 + a^4/b^4 z_0^2)`
    </span>
    è€Œæ›²ç‡åŠå¾„ `n = 1//k_n(bm v) = sqrt(x_0^2 + a^4/b^4 z_0^2)`.
  </li>
  <li>
    ç°åœ¨æˆ‘ä»¬ç”¨çº¬åº¦ (çº¬åº¦æ˜¯æŒ‡æ³•çº¿ `PQ` ä¸ `x` è½´çš„å¤¹è§’, è€Œä¸æ˜¯ `/_ POx` ğŸ˜­) è¡¨ç¤ºæ›²ç‡åŠå¾„.
    å‡å®š `P` çš„çº¬åº¦ä¸º `varphi`, è”ç«‹æ³•çº¿æ–œç‡ `tan varphi = z_0/x_0 a^2/b^2` å’Œå­åˆåœˆæ–¹ç¨‹
    `x_0^2/a^2 + z_0^2/b^2 = 1` å¯å¾—
    <span class="formula">
      `x_0 = a/sqrt(1 + b^2/a^2 tan^2 varphi)`.
    </span>
    äºæ˜¯
    <span class="formula">
      `n = sqrt(x_0^2 + a^4/b^4 z_0^2)`
      `= x_0 sqrt(1 + tan^2 varphi)`
      `= x_0 // cos varphi`
      `= a/sqrt(1 + b^2/a^2 tan^2 varphi) 1/(cos varphi)`
      `= a^2/sqrt(a^2 cos^2 varphi + b^2 sin^2 varphi)`.
    </span>
  </li>
  <li>æœ€å, åå‘å»¶é•¿ `P` å¤„çš„æ³•çº¿, äº¤ `z` è½´äº `Q` ç‚¹, äº¤ `x` è½´äº `R` ç‚¹,
    åˆ™ `|PQ|` æ­£å¥½ç­‰äºå‰æ–‡æ‰€æ±‚çš„æ›²ç‡åŠå¾„ `n`, `|RQ| = (1-b^2/a^2)|PQ| = e^2 n`.
    éªŒè¯å¦‚ä¸‹: `P` å¤„çš„æ³•çº¿æ–¹ç¨‹ä¸º
    <span class="formula">
      `(z_0 x)/b^2 - (x_0 z)/a^2 = x_0 z_0(1/b^2 - 1/a^2)`.
    </span>
    å³
    <span class="formula">
      `x/(x_0(1 - b^2/a^2)) - z/(z_0(a^2/b^2 - 1)) = 1`.
    </span>
    äºæ˜¯ `x_R = x_0 (1 - b^2/a^2)`, `z_Q = -z_0(a^2/b^2 - 1)`,
    <span class="formula">
      `|PQ| = sqrt(x_0^2 + (z_0 - z_Q)^2)`
      `= sqrt(x_0^2 + a^4/b^4 z_0^2) = n`.<br>
      `|RQ|/|PQ| = x_R/x_0 = 1-b^2/a^2 = e^2`.
    </span>
    è¿ç”¨ä»¥ä¸Šå‡ ä½•æ€§è´¨ä¸éš¾æ¨å‡º `P` ç‚¹çš„åæ ‡ä¸º
    <span class="formula">
      `x = n cos varphi cos theta`,<br>
      `y = n cos varphi sin theta`,<br>
      `z = n * b^2/a^2 sin varphi`.
    </span>
  </li>
</ol>

<script src="../../js/note.js?type=math"></script>
<script src="../../js/plot.js"></script>
<script src="../../code/vec.js"></script>
<script src="../../js/ui.js"></script>
<script>
{
const { normalize, cross, dot, rotate3d } = Vec
const { PI, sin, cos, tan, atan2, asin, acos } = Math

const lonlat2xyz = (lonlat) => {
  const lon = lonlat[0] / 180 * PI
  const lat = lonlat[1] / 180 * PI
  return [cos(lat) * cos(lon), cos(lat) * sin(lon), sin(lat)]
}

const xyz2lonlat = (xyz) => {
  const lon = atan2(xyz[1], xyz[0]) / PI * 180
  const lat = asin(xyz[2]) / PI * 180
  return [lon, lat]
}

const data = {
  lon1: 0,
  lat1: 0,
  lon2: 100,
  lat2: 50,
  begin: undefined,
  end: undefined,
  lat: undefined,
}

const lonFn = (a) => {
  const res = rotate3d(data.begin, data.axis, a)
  const lonlat = xyz2lonlat(res)
  data.lat = lonlat[1]
  return lonlat[0]
}

const latFn = (a) => {
  return tan(data.lat * PI / 180)
}

const plot = new Plot('img-arc-lonlat')
const replot = () => {
  data.begin = lonlat2xyz([data.lon1, data.lat1])
  data.end = lonlat2xyz([data.lon2, data.lat2])
  data.axis = normalize(cross(data.begin, data.end))
  data.angle = acos(dot(data.begin, data.end))
  plot.clear()
    .geometry({ xmin: -180, xmax: 180, ymin: -PI, ymax: PI })
    .axis({ xlabel: 'lon', ylabel: 'tan(lat)' })
    .plot(lonFn, latFn, { min: 0, max: data.angle, continuity: 1e4 })
}

const rangeLon1 = new Range('img-arc-range-lon1', {
  min: -180,
  max: 180,
  step: 1,
  defaultValue: -60,
  onChange (value) {
    data.lon1 = value
    rangeLon1.setLabel('lon1 = ' + value)
    if (this.inited) replot()
    this.inited = true
  },
})
const rangeLon2 = new Range('img-arc-range-lon2', {
  min: -180,
  max: 180,
  step: 1,
  defaultValue: 60,
  onChange (value) {
    data.lon2 = value
    rangeLon2.setLabel('lon2 = ' + value)
    if (this.inited) replot()
    this.inited = true
  },
})
const rangeLat1 = new Range('img-arc-range-lat1', {
  min: -90,
  max: 90,
  step: 1,
  defaultValue: 10,
  onChange (value) {
    data.lat1 = value
    rangeLat1.setLabel('lat1 = ' + value)
    if (this.inited) replot()
    this.inited = true
  },
})
const rangeLat2 = new Range('img-arc-range-lat2', {
  min: -90,
  max: 90,
  step: 1,
  defaultValue: 60,
  onChange (value) {
    data.lat2 = value
    rangeLat2.setLabel('lat2 = ' + value)
    replot()
  },
})
}
</script>
</body>
</html>
