<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>定积分与广义积分</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="../../css/note.css" />
</head>
<body>

<h2>定积分的定义与理论*</h2>

<h3>定积分的定义</h3>

<p class="definition">
  <b>Riemann 积分的经典定义</b>
  设函数 `f` 定义在 `[a, b]` 上. 若存在实数 `I`, `AA epsi gt 0`, `EE delta gt 0`,
  对于 `[a, b]` 的任意<b>分割 (partition)</b>
  <span class="formula">
    `Delta = {x_0, x_1, cdots, x_n}`,
    `quad a = x_0 lt x_1 cdots lt x_n = b`
  </span>
  和关于此分割的任意<b>介点集</b>
  <span class="formula">
    `Xi = {xi_1, xi_2, cdots, xi_n}`,
    `quad xi_k in [x_(k-1), x_k]`,
  </span>
  当<b>分割的模</b>
  <span class="formula">
    `||Delta||`
    `= max_(1 le k le n) Delta x_k`
    `= max_(1 le k le n) (x_k - x_(k-1))`
  </span>
  满足 `||Delta|| lt delta` 时, 有
  <span class="formula">
    `|sum_(k=1)^n f(xi_k) Delta x_k - I| lt epsi`,
  </span>
  则称 `f` 在 `[a, b]` 上<b>Riemann 可积</b>, 记作 `f in R[a, b]`.
  `I` 称为 `f` 在 `[a, b]` 上的<b>积分</b>, 记作
  <span class="formula">
    `int_a^b f(x) dx = I`.
  </span>
  Riemann 可积的定义也可以用极限的语言写作
  <span class="formula">
    `lim_(||Delta|| to 0) sum_(k=1)^n f(xi_k) Delta x_k = I`,
  </span>
  其中, `S(f, Delta, Xi) = sum_(k=1)^n f(xi_k) Delta x_k` 称为 <b>Riemann 和</b>.
</p>

<ol class="remark">
  <li>定义中的 `I` 和 `delta` 与分割 `Delta`、介点集 `Xi` 均无关.</li>
  <li>
    定积分是一个数, 与积分区间 `[a, b]` 和被积函数 `f` 有关,
    但与被积函数的变元无关. 因此 `int_a^b f(x) dx = int_a^b f(t) dt`.
    如果视函数 `f` 为变元, 也可以说定积分是函数的函数, 即泛函.
  </li>
</ol>

<p class="remark">
  Riemann 积分理论有其局限性和不便之处, 为此, 提出了新的积分理论——
  Lebesgue 积分, 这种积分将在实变函数中介绍.
</p>

<ol class="definition">
  <b>Riemann 积分的第二定义 (Darboux 准则)</b>
  <li>记 `I_k = [x_(k-1), x_k]`. 分别称
    <span class="formula">
      `bar S(f, Delta) = sum_(k=1)^n underset (x in I_k)"sup" f(x) |I_k|`,<br>
      `ul S(f, Delta) = sum_(k=1)^n underset (x in I_k)"inf" f(x) |I_k|`
    </span>
    为 `f` 关于分割 `Delta` 的 <b>(Darboux) 上和</b>与<b>下和</b>.
    这里的上、下确界取广义实值, 上确界可以取 `+oo`, 下确界可以取 `-oo`.
  </li>
  <li>对介点集加细, 会使上和减小, 下和增加.  这是因为
    <span class="formula">
      `underset ([a, b])"sup" f ge max(underset ([a,c])"sup" f, underset
      ([c, b])"sup" f)`.
    </span>
  </li>
  <li>任意一个上和总是大于任意一个下和. 比较 `bar S(f, Delta_1)` 和 `ul
    S(f, Delta_2)`, 只需取 `Delta_1, Delta_2` 的公共加细 `Delta`, 则
    <span class="formula">
      `bar S(f, Delta_1)`
      `ge bar S(f, Delta)`
      `ge ul S(f, Delta)`
      `ge ul S(f, Delta_2)`.
    </span>
    这指出上和有下界, 下和有上界.  定义上和的下确界为<b>上积分</b>,
    下和的上确界为<b>下积分</b>:
    <span class="formula">
      `bar(int_a^b) f(x) dx`
      `= underset Delta "inf" bar S(f, Delta)`
      `ge underset Delta "sup" ul S(f, Delta)`
      `= ul(int_a^b) f(x) dx`.
    </span>
    如果上积分等于下积分, 就称 `f` 的积分存在, 且等于上、下积分的值.
  </li>
  <li>
    `f` 在子区间 `I_k` 上的<b>振幅</b>记为
    <span class="formula">
      `omega(f, I_k) = underset (x in I_k)"sup" f(x) - underset (x in I_k)
      "inf" f(x)`.
    </span>
    `f` 关于分割 `Delta` 的振幅定义为:
    <span class="formula">
      `omega(f, Delta)`
      `= sum_(k=1)^n omega(f, I_k) |I_k|`
      `= bar S(f, Delta) - ul S(f, Delta)`.
    </span>
    关于所有分割取下确界, 称为 `f` 在区间上的振幅:
    <span class="formula">
      `omega(f) = underset Delta "inf" omega(f, Delta)`
      `= bar(int_a^b) f(x) dx - ul(int_a^b) f(x) dx`.
    </span>
    因此 `f` Riemann 可积当且仅当 `omega(f) = 0`.
  </li>
</ol>

<p class="theorem">
  <b>Darboux 定理</b>
  <span class="formula">
    `bar(int_a^b) f(x) dx = lim_(||Delta|| to 0) bar S(f, Delta)`,<br>
    `ul(int_a^b) f(x) dx = lim_(||Delta|| to 0) ul S(f, Delta)`.
  </span>
</p>

<p class="proof">
  以第二式为例, 记下积分的值为 `L`, 则存在分割 `Delta_1` 使得
  <span class="formula">
    `|ul S(f, Delta_1) - L| lt epsi`.
  </span>
  由于 Darboux 准则蕴含 `f` 有界 (见下文“可积必有界”), 可设 `|f| le M`;
  又设分割 `Delta_1` 的分点数为 `n`, 现在取 `delta = epsi // 2 n M`,
  则当 `||Delta_2|| lt delta` 时, 取 `Delta_1, Delta_2` 的公共加细 `Delta`, 有
  <span class="formula">
    `|ul S(f, Delta_2) - L|`
    `le |ul S(f, Delta_2) - ul S(f, Delta)|`
    `+ |ul S(f, Delta) - L|`.
  </span>
  上式第二项, 由于 `Delta` 是 `Delta_1` 的加细, 有
  <span class="formula">
    `|ul S(f, Delta) - L|`
    `le |ul S(f, Delta_1) - L|`
    `lt epsi`.
  </span>
  第一项, 由于 `Delta` 比 `Delta_2` 增加的分点至多有 `n` 个, 从而 `ul S(f, Delta_2)`
  至多在 `n` 个子区间上与 `ul S(f, Delta)` 存在差异.
  两个下和之差不会超过区间数 &times; 区间宽度 &times; 区间上函数值的差 `le n * delta * 2M lt epsi`.
  综上有 `|ul S(f, Delta_2) - L| lt 2 epsi`.
</p>

<p class="theorem">
  定积分的 Riemann 定义与 Darboux 定义等价.
</p>

<ol class="proof">
  考虑函数 `f` 在区间 `[a, b]` 上的积分.
  <li>Riemann `rArr` Darboux:
    对任意 `epsi gt 0`, 由 Riemann 可积知道存在实数 `I` 和 `delta gt 0`, 当 `||Delta|| lt delta` 时,
    对任意介点集 `Xi` 成立
    <span class="formula">
      `|S(f, Delta, Xi) - I| lt epsi`.
    </span>
    我们可以取介点集 `Xi_1`, 使 `f(xi_k)` 接近 `f` 在 `I_k` 的上确界:
    <span class="formula">
      `|f(xi_k) - underset(x in I_k) "sup"f(x)| lt epsi`, `quad k = 1, cdots, n`.
    </span>
    于是
    <span class="formula">
      `|S(f, Delta, Xi_1) - bar S(f, Delta)| le epsi (b-a)`.
    </span>
    同理取 `Xi_2`, 使得
    <span class="formula">
      `|S(f, Delta, Xi_2) - ul S(f, Delta)| le epsi (b-a)`.
    </span>
    于是
    <span class="formula align">
      `bar S(f, Delta) - ul S(f, Delta)`<br>
      `le |bar S(f, Delta) - S(f, Delta, Xi_1)|`
      `+ |S(f, Delta, Xi_1) - I|`<br>
      `+ |I - S(f, Delta, Xi_2)|`
      `+ |bar S(f, Delta, Xi_2) - ul S(f, Delta)|`<br>
      `le epsi(b-a) + epsi + epsi + epsi(b-a)`.
    </span>
  </li>
  <li>Darboux `rArr` Riemann:
    对任意分割 `Delta` 和介点集 `Xi`, `f` 的 Riemann 和可以被 Darboux 和控制:
    <span class="formula">
      `ul S(f, Delta) le S(f, Delta, Xi) le bar S(f, Delta)`.
    </span>
    令 `||Delta|| to 0`, 由 Darboux 定理知上式左右两边分别趋于上积分和下积分,
    由假设它们都等于 `I`, 因此 `lim_(||Delta|| to 0) S(f, Delta, Xi) = I`.
  </li>
</ol>

<p class="example">
  Dirichlet 函数 `D(x) = chi_QQ = { 0, if x !in QQ; 1, if x in QQ :}`
  在 `[0, 1]` 上不可积. 原因是无论分割取得多细, 每个小区间上的振幅始终等于
  1.
</p>

<h3>定积分的性质</h3>

<p class="proposition">
  <b>可积必有界</b>
  若 `f in R[a, b]`, 则 `f` 在 `[a, b]` 上有界.
</p>

<p class="proof">
  若 `f` 在 `[a, b]` 上无界, 考虑区间的任意分割 `Delta`,
  `f` 至少在其中一个子区间 `I_k` 上无界. 从而 `omega(f, I_k) ge 1//|I_k|`,
  进而 `omega(f, Delta) ge omega(f, I_k) |I_k| ge 1`. 这说明 `f` 不可积.
</p>

<p class="proposition">
  <b>单调必可积</b>
  若 `f` 在 `[a, b]` 上单调, 则 `f in R[a, b]`.
</p>

<p class="proof">
  对任意分割 `Delta`, 考虑
  <span class="formula">
    `omega(f, Delta)`
    `= sum_(k=1)^n omega(f, I_k) |I_k|`
    `le sum_(k=1)^n omega(f, I_k) ||Delta||`
    `= |f(a) - f(b)| * ||Delta||`.
  </span>
  令 `||Delta|| to 0` 即得结论.
</p>

<p class="proposition">
  <b>连续必可积</b>
  若 `f in C[a, b]`, 则 `f in R[a, b]`.
</p>

<p class="proof">
  闭区间 `[a, b]` 上的连续函数是一致连续的:
  对任意 `epsi gt 0`, 存在 `delta gt 0`, 使得
  <span class="formula">
    `|f(x) - f(y)| lt epsi`, `quad AA |x-y| lt delta`.
  </span>
  因此只要分割足够细 (小于 `delta`), 在每个区间上的振幅就小于 `epsi`,
  从而总的振幅小于 `epsi(b-a)`.
</p>

<p class="proposition">
  <b>挖去有限个点, 不影响可积性</b>
  设 `f` 在 `[a, b]` 上有界, `c in [a, b]`, 且对任意小的 `delta gt 0`, `f`
  分别在 `[a, c-delta]`, `[c+delta, b]` 上可积, 则 `f` 在 `[a, b]` 上可积.
</p>

<p class="proof">
  设 `|f| le M`. 对任意 `epsi gt 0`, 取 `delta lt epsi // 4 M`, 下面说明区间
  `[c-delta, c+delta]` 长度足够小, 且 `f` 在 `[a, c-delta] uu
  [c+delta, b]` 上的振幅足够小.<br>
  事实上, 存在 `[a, c-delta]` 和 `[c+delta, b]` 的分割 `Delta_1, Delta_2`
  使得
  <span class="formula">
    `omega(f, Delta_i) lt epsi`, `quad i = 1, 2`.
  </span>
  取 `Delta_1, Delta_2` 的公共加细, 并加入 `c-delta, c+delta` 两个分点,
  组成的分割记为 `Delta`, 则
  <span class="formula">
    `omega(f, Delta) lt 2epsi + 2delta * 2M lt 3epsi`.
  </span>
</p>

<ol class="proposition">
  <b>定积分的运算性质</b> 设 `f, g` 在 `[a, b]` 上可积, 则
  <li>线性性.  对任意常数 `k, l`, 下式左边的积分存在且等式成立:
    <span class="formula">
      `int_a^b (k f(x) + l g(x)) dx` `= k int_a^b f(x) dx + l int_a^b g(x) dx`;
    </span>
  </li>
  <li>区间可加性. 若 `f in R[a,c] uu R[c,b]`, 则 `f in R[a, b]`, 且
    <span class="formula">
      `int_a^b f(x) dx = int_a^c f(x) dx + int_c^b f(x) dx`;
    </span>
  </li>
  <li>保序性. 若 `f(x) le g(x)`, 则
    <span class="formula">
      `int_a^b f(x) dx le int_a^b g(x) dx`;
    </span>
  </li>
</ol>

<p class="proposition">
  <b>连续函数与可积函数的复合可积</b>
  设 `f in R[a, b]`, 则 `f` 有界, 设它的值域含于 `[c, d]`;
  又设 `varphi in C[c, d]`, 则复合函数 `varphi @ f in R[a, b]`.
</p>

<ol class="proof">
  <li>由于 `varphi` 在 `[c, d]` 上一致连续, 对任意 `epsi gt 0`, 存在 `delta
    gt 0`, 使得对任意 `s, t in [c, d]`, 只要 `|s - t| lt delta`, 就有
    `|varphi(s) - varphi(t)| lt epsi`.
  </li>
  <li>考虑 `[a, b]` 的一个分割 `Delta`, 将 `[a, b]` 的子区间分为两类:
    <span class="formula">
      `k in {Lambda, if omega(f, I_k) lt delta; Lambda', otherwise:}`
    </span>
    我们来证明, 第一类区间上的振幅足够小, 而第二类区间的长度足够小.
  </li>
  <li>对于 `k in Lambda`, 有 `omega(f, I_k) lt delta`,
    则 `omega(varphi @ f, I_k) lt epsi`.
    另一方面, 若 `k in Lambda'`, 则
    <span class="formula">
      `delta sum_(k in Lambda') |I_k|`
      `le sum_(k in Lambda') omega(f, I_k) |I_k|`
    </span>
    由 `f` 可积, 可以取分割足够细, 使得上式右边 `le delta^2`, 从而
    `sum_(k in Lambda') |I_k| le delta`.
  </li>
  <li>
    综上有
    <span class="formula">
      `omega(varphi @ f, Delta) le epsi(b-a) + delta * 2 B`,
    </span>
    其中 `B` 是 `varphi` 在 `[c, d]` 上的界.
    我们可以取 `delta lt epsi`, 从而 `varphi @ f` 可积.
  </li>
</ol>

<ol class="proposition">
  <li><b>乘积的可积性</b>. 若 `f, g in R[a, b]`, 则 `f g in R[a, b]`;
  </li>
  <li><b>绝对可积</b>. 若 `f in R[a, b]` 则  `|f| in R[a, b]`,
    且 `|int_a^b f(x) dx| le int_a^b |f(x)| dx`.</li>
</ol>

<ol class="proof">
  <li>取 `varphi(t) = t^2`, 则 `(f + g)^2`, `(f - g)^2 in R[a, b]`,
    进而 `f g = [(f + g)^2 - (f - g)^2]//4 in R[a, b]`.
  </li>
  <li>若 `f` 可积, 取 `varphi(t) = |t|` 知 `|f|` 也可积.
    利用不等式 `-|f| le f le |f|` 和保序性知道 `|int_a^b f(x) dx| le
    int_a^b |f(x)| dx`.
  </li>
</ol>

<ol class="remark">
  <li>
    乘积的可积性保证了内积 `f * g = int_a^b f(t) g(t) dt`
    和卷积 `f ** g = int_a^b f(t) g(x-t) dt` 的存在性.
  </li>
  <li>
    反之若 `|f|` 可积, 则 `f` 不一定可积. 如 `D(x) - 1//2`, `D(x)` 是
    Dirichlet 函数. 这个问题将在 Lebesgue 积分中解决.
  </li>
</ol>

<h3>积分中值定理</h3>

<p class="lemma">
  设 `f` 连续非负且 `int_a^b f(x) dx = 0`, 则 `f(x)` 恒等于零.
</p>

<p class="proof">
  反设 `f(x_0) gt 0`, 则由极限保号性, 在 `x_0` 的附近存在一个小区间 `(x_0 - delta, x_0 + delta)`
  使得 `f(x) gt 0`. 于是积分存在一个正的达布下和, 结果必为正, 矛盾.
</p>

<p>
  以下两个定理都是对函数乘积的积分的估计, 但使用的前提条件不同.
</p>

<p class="theorem">
  <b>积分第一中值定理</b>
  设 `f, g in C[a, b]`, `g ge 0`, 则存在 `xi in [a, b]` 使得
  <span class="formula">
    `int_a^b f(x) g(x) dx`
    `= f(xi) int_a^b g(x) dx`.
  </span>
</p>

<p class="proof">
  若 `g` 恒等于零, 结论显然成立. 下设 `g` 不恒等于零, 由引理知 `int_a^b g(x) dx gt 0`.
  <br>
  设 `f` 在 `[a, b]` 上的最大和最小值分别是 `M, m`, 由保序性
  <span class="formula">
    `int_a^b m g(x) dx`
    `le int_a^b f(x) g(x) dx`
    `le int_a^b M g(x) dx`
  </span>
  即
  <span class="formula">
    `m le (int_a^b f(x) g(x) dx)/(int_a^b g(x) dx) le M`.
  </span>
  由连续函数的介值性, 存在 `xi in [a, b]` 使得
  <span class="formula">
    `f(xi) = (int_a^b f(x) g(x) dx)/(int_a^b g(x) dx)`.
  </span>
</p>

<ol class="theorem">
  <b>积分第二中值定理*</b>
  设 `f in R[a, b]`, 对任意 `xi in [a, b]`, 可以把 `f` 的积分掰成两半, 记为
  `F_l(xi) = int_a^xi f(x) dx` 和 `F_r(xi) = int_xi^b f(x) dx`.
  <li>若 `g` 非负单减, 则存在 `xi in [a, b]` 使得
    <span class="formula">
      `int_a^b f(x) g(x) dx = g(a) F_l(xi)`
    </span>
  </li>
  <li>若 `g` 非负单增, 则存在 `eta in [a, b]` 使得
    <span class="formula">
      `int_a^b f(x) g(x) dx = g(b) F_r(eta)`.
    </span>
  </li>
  <li>若 `g` 单调, 则存在 `xi in [a, b]`, 使得
    <span class="formula">
      `int_a^b f(x) g(x) dx` `= g(a) F_l(xi) + g(b) F_r(xi)`.
    </span>
  </li>
</ol>

<ol class="proof">
  <li>
    首先说明结论 1. 2. 是等价的.
    比如 `g` 单减时, 对函数 `h(x) = g(a+b-x)` 应用结论 2. 使用区间再现的技巧, 有
    <span class="formula align">
      `int_a^b f(x) g(x) dx`<br>
      `= int_a^b f(a+b-x) g(a+b-x) dx`<br>
      `= int_a^b f(a+b-x) h(x) dx`<br>
      `= h(b) int_eta^b f(a+b-x) dx`<br>
      `= g(a) int_a^(a+b-eta) f(x) dx`.
    </span>
    令 `xi = a + b - eta` 就得到结论 1.
  </li>
  <li>结论 3. 是 1. 2. 的推论.
    例如当 `g` 单减时, 对函数 `g(x) - g(b)` 应用结论 1. 有:
    <span class="formula">
      `int_a^b f(x) g(x) dx - int_a^b f(x) g(b) dx`
      `= g(a) F_l(xi) - g(b) F_l(xi)`,
    </span>
    整理即得结论.
  </li>
  <li>下证结论 2. 若 `g` 恒等于零结论显然成立. 否则, 有 `g(b) gt 0`.
    我们先设 `g` 连续可微, 记 `F(x) = int_a^x f(t) dt`,
    于是 `F(x)` 连续, `g'` 非负.
    分部积分, 然后应用积分第一中值定理, 有:
    <span class="formula align">
      `int_a^b f(x) g(x) dx`<br>
      `= g(b) F(b) - int_a^b F(x) g'(x) dx`<br>
      `= g(b) F(b) - F(xi) int_a^b g'(x) dx`<br>
      `= g(b) F(b) - F(xi) (g(b) - g(a))`.
    </span>
    两边同除以 `g(b) gt 0` 得到
    <span class="formula">
      `1/(g(b)) int_a^b f(x)g(x) dx`
      `= F(b) - F(xi)(1 - (g(a))/(g(b)))`.
    </span>
    注意 `F(xi) (1 - g(a)//g(b))` 介于 `F(xi)` 和 `F(a) = 0` 之间, 由连续函数的介值性, 存在
    `eta in [a, xi]` 使得 `F(eta) = F(xi) (1 - g(a)//g(b))`,
    因此上式右侧等于
    <span class="formula">
      `F(b) - F(eta)`
      `= int_eta^b f(x) dx`.
    </span>
  </li>
  <li>从《实变函数》知道, 单调函数实际上具有很好的性质: 几乎处处可导. 因此我们离成功证明并不遥远.
    为改进上述证明, 思路是将积分改写为求和, 并运用 Abel 变换 (分部求和).
    首先, 任取分割 `Delta = {a = x_0, cdots, x_n = b}`, 则
    <span class="formula align">
      `int_a^b f(x) g(x) dx`<br>
      `= sum_(k=1)^n int_(I_k) f(x) g(x) dx`<br>
      `= sum_(k=1)^n int_(I_k) f(x) (g(x) - g(x_k)) dx`<br>
      `quad + sum_(k=1)^n int_(I_k) f(x) g(x_k) dx`<br>
      `:= S_1 + S_2`.
    </span>
    设 `|f| le A`.
    对任意 `epsi gt 0`, 由于 `g` 单调从而可积,
    换言之, 存在 `delta gt 0`, 使得 `||Delta|| lt delta` 时,
    `sum_k omega(g, I_k) |I_k| lt epsi`, 于是上式第一项
    <span class="formula align">
      `S_1 = sum_(k=1)^n int_(I_k) f(x) (g(x) - g(x_k)) dx`<br>
      `le A sum_(k=1)^n omega(g, I_k) |I_k|`<br>
      `le A epsi`.
    </span>
    由于 `f` 可积, `g` 单调, 积分 `int_a^b f(x) g(x) dx` 总是存在. 因此我们证明了
    <span class="formula">
      `lim_(||Delta|| to 0) S_2 = int_a^b f(x) g(x) dx`.
    </span>
    对 `S_2` 使用 Abel 变换, 注意 `F(x_0) = F(a) = 0`:
    <span class="formula align">
      `S_2 = sum_(k=1)^n g(x_k) int_(I_k) f(x) dx`<br>
      `= sum_(k=1)^n g(x_k) (F(x_k) - F(x_(k-1)))`<br>
      `= sum_(k=1)^n g(x_k) F(x_k) - sum_(k=0)^(n-1) g(x_(k+1)) F(x_k)`<br>
      `= g(x_n) F(x_n) - g(x_1) F(x_0)`<br>
      `quad + sum_(k=1)^(n-1) (g(x_k) - g(x_(k+1))) F(x_k)`<br>
      `= g(b) F(b) + sum_(k=0)^(n-1) (g(x_k) - g(x_(k+1))) F(x_k)`.
    </span>
    设 `F` 在 `[a, b]` 的最大和最小值分别是 `M, m`, 假定 `g` 非负单减且 `g(a) gt 0`, 有
    <span class="formula">
      `S_2 le g(b) M + sum_(k=0)^(n-1) (g(x_k) - g(x_(k+1))) M`
      `= g(a) M`.
    </span>
    同理 `S_2 ge g(a) m`.
    令 `||Delta|| to 0`, 我们得到
    <span class="formula">
      `g(a) m le int_a^b f(x) g(x) dx le g(a) M`.
    </span>
    由连续函数的介值性, 存在 `xi in [a, b]` 使得 `1/(g(a)) int_a^b f(x) g(x) dx = F(xi)`,
    即得结论.
  </li>
</ol>

<h3>Riemann 积分与测度</h3>

<p>我们已经看到连续必可积. 反之, 可积函数对连续性也有一定的要求, 比如
  Dirichlet 函数处处不连续, 性质不好, 导致它不可积. 那么如果对 Riemann
  可积函数的连续性作出适当的刻画?  本节将证明, 有界函数 `f` 在 `[a, b]`
  上可积当且仅当它几乎处处连续.
</p>

<ol class="definition">
  <b>零测集与几乎处处</b>
  <li>设 `E sube RR`, 若一列开区间 `I = {I_k}_(k=1)^oo` 满足
    `E sube uuu_(k ge 1) I_k`, 则称它为 `E` 的一个可数开区间覆盖.
    `||I|| = sum_(k ge 1) |I_k|` 称为这个覆盖的模.
  </li>
  <li>关于 `E` 的所有可数开区间覆盖 `I` 的模取下确界, 称为 `E`
    的<b>外测度</b>: `m^**(E) = underset (I) "inf"||I||`.
    之所以叫外测度, 是因为我们从 `E` 的外部对它的大小进行度量.
  </li>
  <li>
    若 `m^**(E) = 0`, 则称 `E` 为<b>零测集</b>. 换言之, `E`
    为零测集当且仅当对任意 `epsi gt 0`, 存在一列开区间 `{I_k}`, 满足
    <span class="formula">
      `E sube uuu_(k ge 1) I_k`,
      `quad sum_(k ge 1) |I_k| lt epsi`.
    </span>
  </li>
  <li>若函数 `f` 在 `[a, b]` 上有定义, 且在一个零测集之外, 即在 `[a, b]\\E`
    上处处具有性质 `P`, 则称 `f` <b>几乎处处</b>具有性质 `P`,
    如几乎处处连续, 几乎处处可微等.
  </li>
</ol>

<p class="corollary">
  可数个零测集的并是零测集.
</p>

<p class="proof">
  设 `{E_n}` 是一列零测集, 对每个正整数 `n` 取 `E_n` 的覆盖
  `{I_(n, k)}_(k=1)^oo`, 使得 `sum_(k ge 1) |I_(n,k)| le 2^-n epsi`.
  于是 `uuu_(n ge 1) E_n sube uuu_(n, k ge 1) I_(n,k)`, 且
  <span class="formula">
    `sum_(n, k ge 1) |I_(n,k)| le sum_(n ge 1) 2^-n epsi = epsi`.
  </span>
</p>

<p class="theorem">
  <b>Lebesgue 定理</b>
  `[a, b]` 上的有界函数 `f` Riemann 可积当且仅当它几乎处处连续, 换言之,
  `f` 的不连续点的集合是零测集.
</p>

<h3>有界变差函数</h3>

[来自 菲赫金哥尔茨《微积分学教程（第三卷）》]

<p class="definition">
  <b>有界变差函数</b>
  设 `f(x)` 在区间 `[a, b]` 上有定义. 类似 Riemann 积分, 取分割
  <span class="formula">
    `Delta: a = x_0 lt x_1 lt cdots lt x_n = b`.
  </span>
  并考虑求和
  <span class="formula">
    `sum_(k=1)^n |Delta f(x_k)|`
    `= sum_(k=1)^n |f(x_k) - f(x_(k-1))|`.
  </span>
  关于 `[a, b]` 所有可能的分割取上确界, 称为 `f` 在 `[a, b]` 的<b>全变差</b>:
  <span class="formula">
    `vvv_a^b f(x) := underset Delta Sup sum_(k=1)^n |Delta f(x_k)|`.
  </span>
  如果 `vvv_a^b f(x) lt oo`, 就称 `f` 在 `[a, b]` 上<b>有界变差</b>, 记作 `f in B V[a, b]`.
</p>

<ol class="corollary">
  <li>
    设 `f` 是有界单调函数, 显然 `vvv_a^b f(x) = |f(a) - f(b)| lt oo`, 所以 `f` 有界变差.
  </li>
  <li>设 `f` 在 `[a, b]` 上分段单调, 则 `f` 有界变差.</li>
  <li>设 `f` 在 `[a, b]` 上满足 Lipschitz 条件: 存在常数 `L gt 0`, 使得
    <span class="formula">
      `|f(x) - f(y)| le L|x - y|`, `quad AA x, y in [a, b]`,
    </span>
    则 `f` 有界变差.
  </li>
  <li>设 `f` 在 `[a, b]` 上可以写为变上限积分
    <span class="formula">
      `f(x) = c + int_a^x varphi(t) dt`,
    </span>
    且 `varphi(t)` 在 `[a, b]` 上绝对可积, 则 `f` 有界变差:
    <span class="formula">
      `vvv_a^b f(x) = int_a^b |varphi(t)| dt lt oo`.
    </span>
  </li>
</ol>

<p class="example">
  尽管 `x^2 sin(1/x)` 在 `0` 附近无限振动, 但它的导数有界, 从而满足
  Lipschitz 条件, 这说明它是有界变差函数.
  另一方面, `x sin(1/x)` 不是有界变差函数, 可以取 `x_k` 让 `sin(1/x) = +-1`, 比如
  `x_k = 1/(pi//2 + k pi)`, 这时
  <span class="formula">
    `|f(x_k) - f(x_(k-1))|`
    `= 1/pi (1/(k-1//2) + 1/(k+1//2))`
    `ge 2/(k pi)`.
  </span>
  对 `k` 求和得到调和级数, 它没有上界.
</p>

<ol class="proposition">
  <b>有界变差函数的性质</b>
  <li>有界变差函数必有界.</li>
  <li>两个有界变差函数之和、差、乘积都是有界变差函数.</li>
  <li>若 `f, g` 有界变差, 且 `|g(x)|` 恒大于一个正数, 则 `f // g` 也有界变差.</li>
  <li>区间可加性. 设 `a lt c lt b`, `f` 是 `[a, b]` 上的函数, 则
    `f in B V[a, b] iff f in B V [a, c] and f in B V[c, b]`, 且成立等式
    <span class="formula">
      `vvv_a^b f = vvv_a^c f + vvv_c^b f`.
    </span>
  </li>
</ol>

<p class="theorem">
  `f in B V[a, b]` 当且仅当它能写成两个有界单增函数之差.
</p>

<h3>Stieltjes 积分</h3>

[来自 菲赫金哥尔茨《微积分学教程（第三卷）》]

<p class="definition">
  <b>Stieltjes 积分</b> 是 Riemann 积分的直接推广, 只需把 Riemann 和
  <span class="formula">
    `S(f, Delta, Xi) = sum_(k=1)^n f(xi_k) Delta x_k`
  </span>
  换成 Stieltjes 积分和
  <span class="formula">
    `sigma(f, g, Delta, Xi) = sum_(k=1)^n f(xi_k) Delta g(x_k)`.
  </span>
  其中 `g` 是 `[a, b]` 上的有界函数, `Delta g(x_k) = g(x_k) - g(x_(k-1))`.
  如果 `||Delta|| to 0` 时 `sigma` 有极限, 则称函数 `f` 对 `g` 在 `[a, b]` 上可积,
  称此极限为 `f` 对 `g` 在 `[a, b]` 上的 Stieltjes 积分, 记为
  <span class="formula">
    `(S) int_a^b f(x) "d" g(x) = lim_(||Delta|| to o) sigma`.
  </span>
  积分号前的 `(S)` 表明这是一个 Stieltjes 积分, 下文中我们将省略这个记号.
</p>

<p class="remark">
  这里定义的 Stieltjes 积分又称为 Riemann-Stieltjes 积分. 在现代积分理论中,
  相应的还有 Lebesgue-Stieltjes 积分.
</p>

<ol class="corollary">
  <b>Stieltjes 积分的达布准则</b>
  假设 `g` 单调增, 则每个 `Delta g(x_k) ge 0`.
  取定 `[a, b]` 的一个分割 `Delta`, 考虑上和与下和
  <span class="formula">
    `bar S(f, Delta) = sum_(k=1)^n underset(x in I_k) "sup" f(x) Delta g(x_k)`,<br>
    `ul S(f, Delta) = sum_(k=1)^n inf_(x in I_k) f(x) Delta g(x_k)`.
  </span>
  我们同样有:
  <li>加细介点集, 将使上和减小, 下和增加.</li>
  <li>任意一个上和 `bar S(f, Delta_1)` 大于任意一个下和 `ul S(f, Delta_2)`.</li>
  <li>Stieltjes 积分存在的充要条件是
    <span class="formula">
      `lim_(||Delta|| to 0) (bar S(f, Delta) - ul S(f, Delta)) = 0`.
    </span>
    或
    <span class="formula">
      `lim_(||Delta|| to 0) sum_(k=1)^n omega(f, I_k) Delta g(x_k) = 0`.
    </span>
  </li>
</ol>

<p class="theorem">
  设 `f` 连续, `g` 单调有界 (或有界变差), 则 `f` 对 `g` 可积.
</p>

<p class="proof">
  对任意 `epsi gt 0`, 由 `f` 在 `[a, b]` 一致连续知道, 存在 `delta gt 0`, 使得
  `f` 在每个长度小于 `delta` 的区间内振幅小于 `epsi`.
  于是只要 `||Delta|| lt delta`, 就有
  <span class="formula">
    `sum_(k=1)^n omega(f, I_k) Delta g(x_k)`
    `le epsi sum_(k=1)^n Delta g(x_k)`
    `= epsi (g(b) - g(a))`.
  </span>
  注: 若把 `g` 换成有界变差函数, 则 `sum Delta g(x_k)` 有界, 可积的结论不变.
</p>

<p class="theorem">
  设 `f` Riemann 可积, `g` 满足 Lipschitz 条件,
  则 `f` 对 `g` 可积.
</p>

<p class="theorem">
  <b>Stieltjes 积分的计算</b>
  设 `f` Riemann 可积, `g` 可以写为变上限积分:
  <span class="formula">
    `g(x) = c + int_a^x varphi(t) dt`,
  </span>
  其中 `varphi(t)` 在 `[a, b]` 上绝对可积, 则 `f` 对 `g` 可积, 且成立等式
  <span class="formula">
    `(S) int_a^b f(x) "d" g(x) = (R) int_a^b f(x) varphi(x) dx`.
  </span>
  上式右边是 Riemann 积分, 此定理提供了计算 Stieltjes 积分的实用方法.
  特别当 `g(x)` 在 `[a, b]` 上除有限点处处可微, 且导函数 `g'(x)` 绝对可积时,
  公式中的 `varphi(x)` 可以换成 `g'(x)`.
</p>

<ol class="proposition">
  <b>Stieltjes 积分的性质</b>
  <li>Newton-Leibniz 公式: `int_a^b "d" g = g(b) - g(a)`;</li>
  <li>对 `f` 线性: `int_a^b (k f_1 + l f_2) "d"g`
    `= k int_a^b f_1 "d"g + l int_a^b f_2 "d"g;</li>
  <li>对 `g` 线性: `int_a^b f"d"(k g_1 + l g_2)`
    `= k int_a^b f"d"g_1 + l int_a^b f "d"g_2`.</li>
  <li>区间可加性: 若等式左边的积分存在, 则对任意 `c in [a, b]`, 等式右边的两个积分存在且等式成立:
    <span class="formula">
      `int_a^b f "d" g`
      `= int_a^c f "d" g`
      `+ int_c^b f "d" g`.
    </span>
    ⚠ 但是即使等式右边两个积分都存在, 左边的积分还是可能不存在.
  </li>
</ol>

<ol class="proposition">
  <b>Stieltjes 积分的分部积分</b>
  若 `f` 对 `g` 可积, 则 `g` 对 `f` 也可积, 且成立等式:
  <span class="formula">
    `int_a^b f "d" g = f g |_a^b - int_a^b g "d"f`.
  </span>
  与 Riemann 积分相比, 这里去掉了函数连续可微的条件, 因此适用面更广.
</ol>

<ol class="proposition">
  <b>Stieltjes 积分的中值定理</b>
  设在 `[a, b]` 上 `f` 有界, `g` 单增, 且 `f` 对 `g` 可积. 则存在 `inf f le mu le Sup f` 使得
  <span class="formula">
    `int_a^b f "d" g = mu (g(b) - g(a))`.
  </span>
</ol>

<h3>定积分与极限</h3>

<p class="example">
  <b>用级数估计积分</b>
  [来自群友 群句号、刀哥]<br/>
  求极限 `lim_(n to oo) int_pi^(2pi) |sin n x + cos n x|/x dx`.
</p>

<p class="solution">
  极限符号下的式子等于
  <span class="formula">
    `int_pi^(2pi) |sqrt 2 sin(n x+pi/4)|/x dx`
    `= sqrt 2 int_(n pi)^(2n pi) |sin(x + pi/4)|/x dx`
    `= sqrt 2 sum_(n le k lt 2n) int_(k pi)^((k+1)pi) |sin(x + pi/4)|/x dx`.
    <span class="label">`(**)`</span>
  </span>
  利用不等式
  <span class="formula">
    `1/((k+1)pi) int_(k pi)^((k+1)pi) f(x) dx`
    `le int_(k pi)^((k+1)pi) f(x)/x dx`
    `le 1/(k pi) int_(k pi)^((k+1)pi) f(x) dx`,
  </span>
  以及 `int_(k pi)^((k+1)pi) |sin(x+pi/4)| dx = 2`, 得
  <span class="formula">
    `(2sqrt 2)/pi sum_(n le k lt 2n) 1/(k+1)`
    `le (**)`
    `le (2sqrt 2)/pi sum_(n le k lt 2n) 1/k`.
  </span>
  令 `n to oo`, 应用两边夹得到原式等于 `(2sqrt 2)/pi ln 2`.
</p>

<ol class="example">
  <b>周期函数的平均值</b>
  <li>
    设 `f` 周期为 `T`, 在 `[0, T]` 上可积, 则
    <span class="formula">
      `lim_(x to +oo) 1/x int_0^x f(t) dt = 1/T int_0^T f(t) dt`.
    </span>
    等号右边称为这个周期函数的<b>平均值</b>.
    例如有 `lim_(x to +oo) 1/x int_0^x |sin t| dt = 2/pi`.
    注意洛必达法则对这个极限失效.
  </li>
  <li>
    [来自群友 玩家喵、澄] 拓展: `f` 的假设同上. 令 `g` 在 `[0, +oo)` 上非负单增, 且
    `lim_(x to +oo) (g(x)) / (int_0^x g(t) dt) = 0`, 则有
    <span class="formula">
      `lim_(x to +oo) (int_0^x f(t) g(t) dt)/(int_0^x g(t) dt) = 1/T int_0^T f(t) dt`.
    </span>
  </li>
</ol>

<ol class="proof">
  <li>
    记 `A = 1/T int_0^T f(t) dt`, 在每个周期内 `f(t) - A` 的积分为零.
    令 `x = n T + y`, `y in [0, T)`, 则有
    <span class="formula">
      `int_0^x (f(t) - A) dt`
      `= int_0^y (f(t) - A) dt`.
    </span>
    `x to +oo` 时上式有界, 所以
    <span class="formula">
      `lim_(x to +oo) (int_0^x (f(t) - A) dt)/x = 0`,
    </span>
    即得证.
  </li>
  <li>
    仍记 `A = 1/T int_0^T f(t) dt`, 只需证
    <span class="formula">
      `lim_(x to +oo) (int_0^x (f(t) - A) g(t) dt)/(int_0^x g(t) dt) = 0`.
    </span>
    运用积分第二中值定理, 存在 `xi in [0, x]` 使得
    <span class="formula">
      `int_0^x (f(t) - A) g(t) dt`
      `= g(0) int_0^xi (f(t) - A) dt`
      `+ g(x) int_xi^x (f(t) - A) dt`.
    </span>
    两边同除以 `int_0^x g(t) dt`, 由 1. 知右端 `f(t) - A` 的两个积分均有界, 再结合 `g`
    满足的条件就得到极限为 0.
  </li>
</ol>

<p class="theorem">
  <b>控制收敛定理 (DCT)</b>
</p>

<h2>积分的计算</h2>

<h3>换元公式</h3>

<span class="formula">
  `int_0^1 dx/x ==^(y=1//x) int_1^oo dy/y`<br>
  `int_0^1 dx/(1+x^2) ==^(y=1//x) int_1^oo dy/(1+y^2)`<br>
  `int_(-a)^a dx ==^(y=-x) int_(-a)^a dy`<br>
  `int_0^(pi/2) sin x dx ==^(y=pi//2-x) int_0^(pi/2) cos y dy`<br>
  `int_0^1 dx/x ==^(x = "e"^(-y)) int_0^oo dy`
</span>

<h3>利用对称性</h3>

<p>设下面的各个 `f` 在积分区间上有定义且可积.</p>

<p>
  <b>偶函数</b>
  如果 `f` 有对称轴 `x = u`, 即 `f(x) = f(2u-x)`, 那么
  <span class="formula">
    `int_(u-a)^u f(x) dx = int_u^(u+a) f(x) dx`.
  </span>
  特别若 `f` 是偶函数, 则
  <span class="formula">
    `int_(-a)^a f(x) dx = 2 int_0^a f(x) dx`.
  </span>
</p>

<p>
  <b>奇函数</b>
  如果 `f` 有对称中心 `(u, v)`, 即 `f(x) = 2v - f(2u-x)`, 那么
  <span class="formula">
    `int_(u-a)^u f(x) dx + int_u^(u+a) f(x) dx = 2va`.
  </span>
  特别若 `f` 是奇函数, 则
  <span class="formula">
    `int_(-a)^a f(x) dx = 0`.
  </span>
</p>

<p>
  <b>周期函数</b>
  如果 `f` 是以 `T` 为周期的周期函数, 则对任意常数 `a`,
  <span class="formula">
    `int_a^(a+T) f(x) dx = int_0^T f(x) dx`.
  </span>
  且 `int_a^x f(t) dt` 以 `T` 为周期当且仅当 `int_0^T f(t) dt = 0`.
</p>

<ol class="proof">
	<li>结论一: 由周期性,
		<span class="formula">
			`int_T^(a+T) f(x) dx`
			`= int_0^a f(y+T) dy`
			`= int_0^a f(y) dy`.
		</span>
		因此
		<span class="formula">
			`int_a^(a+T) = int_a^0 + int_0^T + int_T^(a+T)`
			`= int_a^0 + int_0^T + int_0^a`
			`= int_0^T`.
		</span>
		事实上, 若 `f` 连续, 则
		<span class="formula">
			`"d"/("d"a) int_a^(a+T) f(x) dx`
			`= f(a+T) - f(a) = 0`,
		</span>
		这说明 `int_a^(a+T) f(x) dx` 与 `a` 的取值无关.
		下证结论二.
		<span class="formula">
			`int_a^(x+T) f(t) dt = int_a^x f(t) dt`
			`iff int_x^(x+T) f(t) dt = 0`
			`iff int_0^T f(t) dt = 0`.
		</span>
	</li>
</ol>

<p>
  <b>区间再现</b> 作变元替换 `x = a+b-t`, 有
  <span class="formula">
    `int_a^b f(x) dx = int_a^b f(a+b-t) dt`.
  </span>
  这个公式的一个推论是, 对任意使得 `f(sin x), f(cos x)` 可积的函数
  `f`,
  <span class="formula">
    `int_0^(pi/2) f(sin x) dx = int_0^(pi/2) f(cos x) dx`.
  </span>
  如果 `f` 和 `g` 在同一区间上的积分相等, 我们可以用 `(f+g)//2`
  的积分来替代它, 例如
  <span class="formula">
    `int_0^pi x f(sin x) dx`
    `= int_0^pi (pi-x) f(sin(pi-x)) dx`
    `= pi/2 int_0^pi f(sin x) dx`.
  </span>
</p>

<p class="remark">
  利用积分区域对称性的技巧, 在一元积分中只有一种, 就是区间再现.
  多元积分中, 对称性的使用会更加复杂多样.
</p>

<p class="example">
  `int_0^oo x^a/(1+x^a) dx/(1+x^2)`
</p>

<p class="solution">
  令 `x = tan y`, 原式等于
  <span class="formula">
    `int_0^(pi/2) (sin^a y)/(cos ^a y + sin^a y) dy`
    `= 1/2 int_0^(pi/2) (cos^a y + sin^a y)/(cos^a y + sin^a y) dy`
    `= pi/4`.
  </span>
</p>

<p class="example">
  [来自群友 SmartPig]
  `int_0^(2pi) (x - sin x)(1 - cos x)^2 dx`.
</p>

<p class="solution">
  [来自群友 光绪三十一年钦点的武举人]
  `sin x(1 - cos x)^2` 的周期为 `2pi`, 可以把积分区间移动到 `[-pi, pi]`; 又因为它是奇函数所以积分是零.
  于是原积分化为
  <span class="formula align">
    `int_0^(2pi) x (1-cos x)^2 dx`<br>
    `= int_0^(2pi) pi (1 - cos x)^2 dx`<br>
    `= pi int_0^(2pi) (1 - 2 cos x + cos^2 x) dx`<br>
    `= pi (2pi - 0 + pi)`<br>
    `= 3pi^2`.
  </span>
</p>

<h3>杂例</h3>

<ol class="example">
	<li>`I_1 = int dx / sqrt((a+x)(b-x))`;</li>
	<li>`I_2 = int_h^(R sin phi)
			arccos{: (x cot phi) / sqrt(R^2-x^2) :} dx`,
		`0 lt h lt R sin phi`, `phi in [0, pi/2)`;
	</li>
	<li>`I_3 = int sqrt((a^2x-b^2) / (1-x)) dx/x`;</li>
	<li>`I_4 = int_(h_1)^(r_2) arccos{: (h_2)/sqrt(R^2-x^2) :} dx`,
		其中 `R = sqrt(h_1^2 + r_1^2) = sqrt(h_2^2 + r_2^2)`.
	</li>
</ol>

<ol class="solution">
	<li>令 `t = sqrt((a+x)/(b-x))`,
		则 `x = (bt^2-a) / (1+t^2)`,
		`dx = (2(a+b)t) / (1+t^2)^2 dt`.  于是
		<span class="formula">
			`I_1 = int (2(a+b)t dt)/( t|b-(bt^2-a)/(1+t^2)| (1+t^2)^2 )`
			`= 2 sgn(a+b) int dt / (1+t^2)`
			`= 2 sgn(a+b) * arctan sqrt((a+x)/(b-x)) + C`.
		</span>
	</li>
	<li>令 `u = (x cot phi) / sqrt(R^2-x^2)`,
		则 `x = (Ru) / sqrt(u^2 + cot^2 phi)`.
		记 `r = sqrt(R^2 - h^2)`, 于是
		<span class="formula">
			`I_2 = [(Ru arccos u)/sqrt(u^2+cot^2 phi)]_((h cot phi)//r)^1
			+ R/2 int_((h cot phi)//r)^1 ("d"(u^2))
			/ sqrt( (cot^2 phi + u^2)(1-u^2) )`.
		</span>
		由 1,
		<span class="formula">
			`I_2 = -h arccos{: (h cot phi)/r :}
				+ R[ arctan sqrt((cot^2 phi + u^2) / (1-u^2)) ]
				_((h cot phi)//r)^1`
			`= - h arccos{: (h cot phi)/r :}
				+ R(pi/2-arctan{:(R cot phi) / sqrt(r^2-h^2 cot^2 phi):})`
			`= R arccos{: (R cos phi)/r :} - h arccos{: (h cot phi)/r :}`.
		</span>
	</li>
	<li>令 `t = sqrt((a^2x-b^2)/(1-x))`,
		则 `x = (b^2+t^2)/(a^2+t^2)`,
		`dx = (2t(a^2-b^2)) / (a^2+t^2)^2 dt`.  于是
		<span class="formula">
			`I_3 = int t * (a^2+t^2) / (b^2+t^2)
				* (2t(a^2-b^2)) / (a^2+t^2)^2 dt`
			`= 2 int ( a^2/(a^2 + t^2) - b^2 / (b^2 + t^2) ) dt`
			`= 2 ( a arctan{:t/a:} - b arctan{:t/b:} ) + C`.
		</span>
		再将 `t` 代回, 即得最终结果.
	</li>
	<li>令 `u = h_2/sqrt(R^2-x^2)`,
		则 `x = sqrt( R^2 - (h_2/u)^2 )`.  于是
		<span class="formula">
			`I_4 = [ sqrt( R^2 - (h_2/u)^2 ) arccos u ]_(h_2//r_1)^1
				+ int_(h_2//r_1)^1 sqrt( R^2 - (h_2/u)^2 )
				("d"u) / sqrt(1-u^2)`
			`=	- h_1 arccos {:h_2/r_1:}
				+ 1/2 int_(h_2//r_1)^1 sqrt( (R^2u^2 - h_2^2) / (1-u^2) )
				( "d"(u^2) ) / u^2`.
		</span>
		由 3 知, 上式第二项等于
		<span class="formula">
			`[R arctan{:1/R:} sqrt((R^2u^2 - h_2^2)/(1-u^2))
				- h_2 arctan{:1/h_2:}
				sqrt((R^2u^2 - h_2^2)/(1-u^2)) ]_(h_2//r_1)^1`
			`= pi/2 (R-h_2)
				- (R arctan{:(h_1 h_2)/(R sqrt(r_1^2 - h_2^2)):}
				- h_2 arctan{:h_1/sqrt(r_1^2 - h_2^2):} )`
			`= R arccos{:(h_1 h_2)/(r_1 r_2):} - h_2 arccos{:h_1/r_2:}`.
		</span>
		故
		<span class="formula">
			` I_4 = R arccos{:(h_1 h_2)/(r_1 r_2):}
			- h_1 arccos{:h_2/r_1:}
			- h_2 arccos{:h_1/r_2:}`.
		</span>
	</li>
</ol>

<p class="example">
    `int_(-pi)^pi (x sin x * arctan "e"^x) / (1+cos^2 x) dx`
</p>

<p class="solution">
    区间再现. 用 `-x` 代替 `x`, 原式等于
    <span class="formula">
        `int_(-pi)^pi (x sin x * arctan "e"^-x) / (1+cos^2 x) dx`
        `= pi/4 int_(-pi)^pi (x sin x)/(1+cos^2 x) dx`
        `= pi/2 int_0^pi (x sin x)/(1+cos^2 x) dx`.
    </span>
    再次区间再现. 用 `pi-x` 代替 `x`, 上式等于
    <span class="formula">
        `pi/2 int_0^pi ((pi-x) sin x)/(1+cos^2 x) dx`
        `= pi^2/4 int_0^pi (sin x dx)/(1+cos^2 x)`
        `= -pi^2/4 int_1^(-1) dx/(1+x^2) = pi^3/8`.
    </span>
</p>

<p class="example">
	`int_0^(2pi) (1-cos t)^2 (t-sin t) dt`.
</p>

<p class="solution">
	因为不定积分 `int (1-cos t)^2 sin t dt` 的结果是 `cos t` 的多项式,
	周期是 `2pi`, 所以这一项在 `[0, 2pi]` 上的积分等于零.
	<span class="formula">
		原式 `= int_0^(2pi) (1-cos t)^2 t dt`
		`= int_0^(2pi) (2 sin^2{:t/2:})^2 t dt`
		`= 16 int_0^pi u sin^4 u "d" u`
		`= 16 int_0^pi (pi-u) sin^4 u "d"u`
		`= 8 pi int_0^pi sin^4 u "d"u`
        `= 16 pi int_0^(pi/2) sin^4 u "d"u`
        `= 16 pi * 3/4 * 1/2 * pi/2`
		`= 3 pi^2`.
	</span>
</p>

<ol class="example">
  [来自 刀哥]
  `n` 为正整数, 证明:
  <li>`int_0^(pi/2) (sin (2n-1)x)/sin x dx = pi/2` (Dirichlet 核);</li>
  <li>`int_0^(pi/2) ((sin n x)/sin x)^2 dx = (n pi)/2` (费耶核).</li>
</ol>

<ol class="proof">
  <li>
    只需验证 `n = 1` 时结论成立, 且有
    <span class="formula">
      `int_0^(pi/2) (sin (2n+1)x - sin(2n-1)x)/sin x dx`
      `= int_0^(pi/2) 2 cos 2n x dx = 0`.
    </span>
  </li>
  <li>
    只需验证 `n = 1` 时结论成立, 且由 1. 有
    <span class="formula align">
      `int_0^(pi/2) (sin^2 (n+1) x - sin^2 n x) dx/(sin^2 x)`<br/>
      `= int_0^(pi/2) (sin (n+1) x + sin n x)(sin (n+1) x - sin n x) dx/(sin^2 x)`<br/>
      `= 4 int_0^(pi/2) sin(n+1/2)x cos{:x/2:} cos(n+1/2)x sin{:x/2:} dx/(sin^2 x)`<br/>
      `= int_0^(pi/2) (sin(2n+1)x)/sin x dx = pi/2`.<br/>
    </span>
  </li>
</ol>

<p class="proof">
  1. 的又一证明: 由
  <span class="formula">
    `2 sin x sum_(k=1)^n cos 2k x = sin(2n+1)x - sin x`
  </span>
  知,
  <span class="formula">
    `(sin(2n+1)x)/sin x = 1 + 2 sum_(k=1)^n cos 2k x`.
  </span>
  因此积分为 `pi/2`.
</p>

<p class="example">
  `2n-1 lt 15` 时,
  <span class="formula">
    `int_0^oo prod_(k=1)^n (sin(x//(2k-1)))/(x//(2k-1)) dx = pi/2`.
  </span>
  然而 `2n-1 = 15` 时, 等号不成立.
</p>

<p class="proof">
  `2n-1 = 3` 时, 运用积化和差,
  <span class="formula">
    `int_0^oo (sin x)/x (sin(x//3))/(x//3) dx`
    `= 3/2 int_0^oo (cos (2x//3) - cos (4x//3))/x^2 dx`
    `= 3/2 (4/3 - 2/3) pi/2 = pi/2`.
  </span>
  ??
</p>

<p class="example">
  [来自 暗恋你的高中生]
  `int_0^1 f(2x sqrt(1-x^2)) dx = int_0^1 f(1-x^2) dx`.
</p>

<p class="proof">
  左边等于
  <span class="formula">
    `int_0^(pi/2) f(sin 2x) cos x dx`
    `= int_0^(pi/4) + int_(pi/4)^(pi/2)`
    `= int_0^(pi/4) f(sin 2x) (sin x+cos x) dx`
    `= int_0^(pi/4) f(1 - (sin x - cos x)^2) "d"(sin x - cos x)`
  </span>
  等于右边.
</p>

<p class="example">
  `int_0^1 ln (1-x) dx`.
</p>

<p class="solution">
  如果直接分部积分:
  <span class="formula">
    `int_0^1 ln(1-x) dx`
    `= {:x ln (1-x)|_0^1 + int_0^1 (x dx)/(1-x)`
    `= -oo + (+oo)`,
  </span>
  得不到任何信息!
</p>

<p class="solution">
  先区间再现, 再分部积分, 利用 `lim_(x to 0^+) x ln x = 0`:
  <span class="formula">
    `int_0^1 ln (1-x) dx`
    `= int_0^1 ln x dx`
    `= {: x ln x|_0^1 - int_0^1 x/x dx`
    `= 0 - 1 = -1`.
  </span>
</p>

<p class="example">
  [来自 我是萌萌的數心]
  求 `I(m, n) = int_0^(pi/2) cos^m x cos n x dx`, `m, n` 为非负整数.
</p>

<p class="solution">
  先证 `I(m, n) = m/(m+n) I(m-1, n-1)`. 这是因为由积化和差
  <span class="formula">
    `2 I(m, n) = I(m-1, n-1) + I(m-1, n+1)`,
  </span>
  另一方面, 分部积分得
  <span class="formula">
    `I(m, n) = m/n int_0^(pi/2) cos^(m-1) x sin x sin n x dx`
    `= m/(2n) (I(m-1, n-1) - I(m-1, n+1))`.
  </span>
  两式联立消去 `I(m-1, n+1)` 得 `I(m, n) = m/(m+n) I(m-1, n-1)`.<br>
  下证
  <span class="formula">
    `I(m, m + 2n + 1) = (-1)^n (2^m m! (2n)! (m+n)!)/(n! (2m+2n+1)!)`.
  </span>
  这只需验证 `I(0, 2n+1) = (-1)^n/(2n+1)`, 假设命题对 `m-1` 成立, 则
  <span class="formula">
    `I(m, m+2n+1)`
    `m/(2m+2n+1) I(m-1, m+2n)`
    `= m/(2m+2n+1) (-1)^n (2^(m-1) (m-1)! (2n)! (m+n-1)!)/(n! (2m+2n-1)!)`
    `= (-1)^n (2^m m! (2n)! (m+n)!)/(n! (2m+2n+1)!)`.
  </span>
  最后, 因为 `I(0, 2n) = {pi/2, if n = 0; 0, otherwise:}`,
  所以 `I(m, m+2n) = { pi/2^(m+1), if n = 0; 0, otherwise :}`.
</p>

<p class="example">
  [来自 我是萌萌的數心] 求`I_n = int_(-oo)^oo  dx/(x^2+2ax+b)^n`, 其中 `Delta = 4(a^2-b) lt 0`.
</p>

<p class="solution">
  令 `x+a = sqrt(b-a^2) tan u`,
  <span class="formula align">
    `I_n = int_(-pi/2)^(pi/2) sqrt(b-a^2)/cos^2 u ("d"u)/((b-a^2)^n(1+tan^2 u)^n)`<br>
    `= (b-a^2)^(1/2-n) int_(-pi/2)^(pi/2) cos^(2n-2) u "d"u`<br>
    `= (b-a^2)^(1/2-n) pi ((2n-3)!!)/((2n-2)!!)`<br>
    `= (b-a^2)^(1/2-n) pi ((2n-2)!)/({:(n-1)!:}^2 2^(2n-2))`<br>
    `= (b-a^2)^(1/2-n) pi/2^(2n-2) (2n-2;n-1)`.
  </span>
</p>

<p class="example">
  [来自 (Almost) Impossible Integrals, Sums, and Series]
  <span class="formula">
    `int_0^(pi//2) dx/(1 + sin x cos y) = y/(sin y)`, `quad y in (0, pi)`.
  </span>
  作为应用, 试计算 `int_0^pi dx/(s + cos x)`, `s gt 1`.
</p>

<div class="p proof">
  记 `u = cos y`, 利用万能代换, 原式等于
  <span class="formula">
    `int_0^1 (2 dt)/(1 + t^2 + 2 t u)`
    `= 2 int_0^1 dt/((t+u)^2 + 1 - u^2)`
    `= 2/sqrt(1-u^2) arctan((t+u)/sqrt(1-u^2)) |_(t=0)^1`
    `= (arccos u)/sqrt(1-u^2)`.
  </span>
  最后一个等式由画图得到.
  <div class="img md">
    <img src="../img/7-atan2acos.png" alt="">
  </div>
</div>

<p class="solution">
  本题可用万能代换, 也可套公式
  <span class="formula">
    `int_0^pi dx/(s + cos x)`
    `= 1/s int_0^(pi/2) dx/(1 + 1/s cos x) + 1/s int_0^(pi/2) dx/(1 - 1/s cos x)`
    `= 1/s (arccos{:1/s:} + arccos(-1/s))/sqrt(1 - 1/s^2)`
    `= pi/sqrt(s^2 - 1)`.
  </span>
</p>

<p class="example">
  `int_-oo^oo f(x) dx = int_-oo^oo f(x - 1/x) dx`.
</p>

<p class="proof">
  左边等于
  <span class="formula">
    `int_0^oo f(y - 1/y) (1+1/y^2) dy`
    `==^(u = 1/y) int_0^oo f(y - 1/y) dy + int_0^oo f(1/u - u) "d"u`
    `==^(u mapsto -u) int_0^oo f(y - 1/y) dy + int_-oo^0 f(u - 1/u) "d"u`
  </span>
  等于右边.
</p>

<h2>含参积分</h2>

<h3>几个著名积分</h3>

<p class="example" id="exp-pi-ln2">
  <b>Euler 积分</b>
  记 `p(x) = -ln|x|`,
  则以下每个积分的值均为 `pi ln 2`:
  <span class="formula">
    `int_0^pi p(sin x) dx`,
		`int_0^pi p(cos x) dx`,
    `int_0^pi p(1+-cos x) dx`,<br>
    `int_(-1)^1 (p(x))/sqrt(1-x^2) dx`,
		`int_(-pi/2)^(pi/2) x cot x dx`,
		`int_(-1)^1 (arcsin x)/x dx`.
  </span>
  记忆: `ln sin x` 在 `[0, pi/2]` 上的均值为 `-ln 2`.
</p>

<ol class="solution">
	<li>`x to 0` 时 `ln sin x ~ ln x`,
		由 `int_0^(pi/2) |ln x| dx` 收敛知, 瑕积分
    <span class="formula">
      `I = int_0^(pi/2) ln sin x dx` `= int_0^(pi/2) ln cos x dx`
    </span>
    在 `0` 处收敛.  注意到 `[0, pi]` 是 `sin x` 的对称区间, 有
		<span class="formula">
			`2I`
      `= int_0^pi ln sin x dx`
      `= int_0^(pi/2) ln sin 2x "d"(2x)`
      `= 2 int_0^(pi/2) (ln 2 + ln sin x + ln cos x) dx`
      `= pi ln 2 + 4 I`,
		</span>
		故 `-2I = pi ln 2`.
	</li>
  <li>只证加号的情形:
    <span class="formula">
      `int_0^pi ln(1+cos x) dx`
      `= int_0^pi ln(2 cos^2{:x/2:}) dx`
      `= pi ln 2 + 2 int_0^pi ln cos{:x/2:} dx`
      `= pi ln 2 + 4 int_0^(pi/2) ln cos x dx`
      `= - pi ln 2`.
    </span>
  </li>
	<li>直接令 `t = sin x` 有:
		<span class="formula">
			`int_0^(pi/2) ln sin x dx = int_0^1 (ln t)/sqrt(1-t^2)`.
		</span>
		另一方面, 若先分部积分,
		<span class="formula">
			`int_0^(pi/2) ln sin x dx = - int_0^(pi/2) x cot x dx`,
		</span>
		这时令 `t = sin x`, 有:
		<span class="formula">
			`int_0^(pi/2) x cot x dx = int_0^1 (arcsin t)/t dt`.
		</span>
	</li>
</ol>

<p class="example">
  <b>Poisson 积分</b>
  [来自 菲赫金哥尔茨] 对于积分
  <span class="formula">
    `I(r) = int_0^pi ln(1+r^2 - 2 r cos x) dx`,
  </span>
  区间再现易得 `I(r) = I(-r)`.  下证:
  <span class="formula">
    `I(r) = { 0, if |r| le 1; 2 pi ln |r|, if |r| gt 1 :}`
  </span>
</p>

<ol class="solution">
  <li>
    先证明方程 `I(r) = 1/2 I(r^2)`:
    <span class="formula">
      `I(r) = 1/2(I(r) + I(-r))`
      `= 1/2 int_0^pi ln (1+r^2+2r cos x)(1+r^2-2r cos x) dx`
      `= 1/2 int_0^pi ln ((1+r^2)^2 - 4r^2 cos^2 x) dx`
      `= 1/2 int_0^pi ln (1+r^4 - 2 r^2 cos 2x) dx`
      `= 1/2 I(r^2)`.
    </span>
  </li>
  <li>
    `|r| lt 1` 时, 由
    <span class="formula">
      `(1-|r|)^2 le 1 + r^2 - 2 r cos x le (1+|r|)^2`
    </span>
    两边取对数再积分得
    <span class="formula">
      `2 pi ln(1-|r|) le I(r) le 2 pi ln(1+|r|)`,
    </span>
    因此 `lim_(r to 0) I(r) = 0`.
    现在若 `|r| lt 1`, 则 `I(r) = I(r^(2^n))//2^n`, 令 `n to oo` 而得到
    `0`;
  </li>
  <li>
    若 `|r| gt 1`, 则
    <span class="formula">
      `I(r) = int_0^pi[ ln(1+1/r^2 - 2/r cos x) + 2 ln |r| ]dx`
      `= I(1/r) + 2 pi ln |r|`
      `= 2 pi ln |r|`.
    </span>
  </li>
  <li>
    最后 `|r| = 1` 时, 化为 Euler 积分
    <span class="formula">
      `int_0^pi [ln(1 + cos x)  + ln 2]dx = 0`.
    </span>
  </li>
</ol>

<p class="solution">
  利用定积分定义,
  <span class="formula">
    `I(r) = lim_(n to oo) pi/n sum_(k=1)^n ln (1+r^2 - 2 r cos{:(k pi)/n:})`
    `= lim_(n to oo) pi/n ln prod_(k=1)^n (r-"e"^(k pi "i"//n))(r-"e"^(-k
    pi "i"//n))`
    `= lim_(n to oo) pi/n ln[(r+1)/(r-1) prod_(k=1)^(2n) (r-"e"^(k pi
    "i"//n))]`
    `= lim_(n to oo) pi/n ln[(r+1)/(r-1) (r^(2n)-1)]`.
  </span>
  若 `|r| lt 1`, 上式 `to 0`; 若 `|r| gt 1`, 上式化为
  <span class="formula">
    `lim_(n to oo) pi/n ln[(r+1)/(r-1) (r^(2n)-1)/r^(2n)] + pi/n * 2n * ln |r|`
    `= 2 pi ln |r|`.
  </span>
</p>

<p class="example">
	<b>Euler-Poisson 积分, 概率积分</b>
  <span class="formula">
    `int_(-oo)^oo "e"^(-x^2) dx = sqrt pi`.
  </span>
  推广为 <b>Poisson 积分</b> (`a gt 0`):
  <span class="formula">
    `int_(-oo)^oo "e"^(-a x^2) cos b x dx`
    `= sqrt(pi/a) "e"^(-b^2/(4a))`.
  </span>
</p>

<p class="proof">
  利用重积分.  设 `D` 是以原点为心, `R` 为半径的圆盘,
  <span class="formula">
    `iint_D "e"^(-x^2-y^2) dx dy`
    `= int_0^(2pi) "d"theta int_0^R "e"^(-r^2) r"d"r`
    `= pi(1 - "e"^(-R^2))`.
  </span>
  另一方面,
  <span class="formula">
    `iint_([-R,R]xx[-R,R]) "e"^(-x^2-y^2) dx dy`
    ` = int_(-R)^R "e"^(-x^2) dx int_(-R)^R "e"^(-y^2) dy`
    ` = (int_(-R)^R "e"^(-x^2) dx)^2`.
  </span>
  令 `R to +oo`, 得 `int_(-oo)^oo "e"^(-x^2) dx = sqrt pi`.
</p>

<ol class="proof">
  <li>
  利用伸缩变换 `x = t y`,
  <span class="formula">
    `I = int_0^oo "e"^(-t^2 y^2) t dy`
  </span>
  对任意 `a gt 0`, 交换积分次序得
  <span class="formula">
    `int_a^oo "e"^(-t^2) I dt`
    `= int_a^oo int_0^oo "e"^(-t^2) "e"^(-t^2 y^2) t dy dt`
    `= int_0^oo int_a^oo "e"^(-t^2 (1+y^2)) t dt dy`
    `= 1/2 int_0^oo "e"^(-a^2(1+y^2))/(1+y^2) dy`
  </span>
  等式两边令 `a to 0^+`, 右边的积分关于 `a` 一致收敛, 得
  <span class="formula">
    `I^2 = 1/2 int_0^oo dy/(1+y^2) = pi/4`,
  </span>
  即 `I = sqrt(pi)/2`.
  </li>
  <li>
  现在证明积分交换的合理性. 考虑被积函数
  <span class="formula">
    `f(t, y) = t "e"^(-t^2(1+y^2))`,
    `quad t ge a gt 0`, `y ge 0`.
  </span>
  该函数在定义域内非负连续, 设 `t "e"^(-t^2) le M`, 则被积函数可以被 `y` 的函数控制:
  <span class="formula">
    `f(t, y) le M "e"^(-t^2 y^2) le M "e"^(-a^2 y^2)`.
  </span>
  这说明积分 `int_0^oo f(t, y) dy` 关于 `t ge a` 一致收敛;
  另一方面被积函数也可以被 `t` 的函数控制:
  <span class="formula">
    `f(t, y) le t "e"^(-t^2)`,
  </span>
  从而积分 `int_a^oo f(t, y) dt` 关于 `y ge 0` 一致收敛, 这两个一致收敛保证了积分换序可以进行.
  </li>
</ol>

<p class="proof">
  取矩形围道, 考虑 `"e"^(-a z^2)` 的积分
  <span class="formula">
    `I = I_1 + I_2 + I_3 + I_4`
    `= int_(-R)^R + int_R^(R+"i"b//2a) + int_(R+"i"b//2a)^(-R+"i"b//2a) + int_(-R+"i"b//2a)^(-R)`,
  </span>
  `R to oo` 时, 利用长大不等式说明两个竖直线上积分趋于零, 如
  <span class="formula">
    `|I_2|`
    `le b/(2a) * "e"^(-a R^2)`
    `to 0`.
  </span>
  于是由 Cauchy 积分定理, `I_1 = -I_3`, 即
  <span class="formula">
    `sqrt(pi/a)`
    `= int_-oo^oo "e"^(-a x^2) dx`
    `= int_-oo^oo "e"^(-a(x+"i"b//2a)^2) dx`
    `= "e"^(b^2/(4a)) int_-oo^oo "e"^(-a x^2)(cos b x + "i" sin b x) dx`
    `= "e"^(b^2/(4a)) int_-oo^oo "e"^(-a x^2) cos b x dx`.
  </span>
</p>

<p class="remark">
	`"e"^(-x^2)` 称为 <b>Gauss 函数</b>,
	<span class="formula">
		`"erf"(x) = 2/(sqrt pi) int_0^x "e"^(-t^2) dt`,
		`quad "erfc"(x) = 1-"erf"(x) = 2/(sqrt pi) int_x^oo "e"^(-t^2) dt`
	</span>
	分别称为<b>误差函数</b>和<b>互补误差函数</b>.
</p>

<p class="remark">
  虽然是一维的积分, 却应当考虑用重积分来解决,
  从更高的维度上给原问题以降维打击.
</p>

<p class="example">
	<b>Dirichlet 积分</b>
  <span class="formula">
    `int_(-oo)^oo (sin x)/x dx = pi`.
  </span>
  利用 <a href="../complex/6.html#exp-dirichlet-integral">Laplace 变换</a>推广为:
  <span class="formula">
    `int_0^oo (sin a x)/x "e"^(-s x) dx = arctan{:a/s:}`.
  </span>
</p>

<ol class="proof">
  <li>收敛性. 由于被积函数是偶函数, 只需考虑 `(0, +oo)` 上的情形:
    <span class="formula">
      `int_0^oo (sin x)/x dx = int_0^(pi/2) + int_(pi/2)^oo`.
    </span>
    第一项是普通的定积分, 我们来说明第二项收敛. 分部积分:
    <span class="formula">
      `|int_(pi/2)^oo (sin x)/x dx|`
      `= |int_(pi/2)^oo (cos x)/x^2 dx|`
      `le int_(pi/2)^oo dx/x^2`.
    </span>
    因此原积分收敛.
    也可以利用 Dirichlet 判别法:
    `int_0^c sin x dx` 关于积分上限 `c` 有界,
    `1/x` 单调趋于 `0`, 因此原积分收敛.
  </li>
  <li>计算. 利用
    <span class="formula">
      `int_0^oo "e"^(-x y) dy = 1/x`,
    </span>
    交换积分次序得
    <span class="formula">
      `int_0^oo (sin x)/x dx`
      `= int_0^oo sin x dx int_0^oo "e"^(-x y) dy`
      `= int_0^oo dy int_0^oo "e"^(-x y) sin x dx`
      `= int_0^oo dy/(y^2+1) = pi/2`.
    </span>
    于是原式等于 `pi`.
  </li>
  <li>积分换序的合理性.
    考察被积函数
    <span class="formula">
      `f(x, y) = sin x "e"^(-x y)`,
      `quad x ge 0, y ge 0`.
    </span>
    当 `x ge a gt 0` 时, `|f(x, y)| le "e"^-a y`;
    当 `y ge c gt 0` 时, `|f(x, y)| le sin x "e"^(-c x)`.
    从而 `int_a^oo f(x,y) dy` 关于 `x` 一致收敛, `int_c^oo f(x,y) dx` 关于
    `y` 一致收敛.
    ??
  </li>
</ol>

<p class="example">
  <b>Fresnel 积分</b>
  <span class="formula">
    `int_(-oo)^oo sin x^2 dx = int_(-oo)^oo cos x^2 dx = sqrt(pi/2)`.
  </span>
  推广:
  <span class="formula">
    `int_0^oo sin x^n dx // sin{:pi/(2n):}`
    `= int_0^oo cos x^n dx // cos{:pi/(2n):}`
    `= 1/n Gamma(1/n)`, `quad n gt 1`.
  </span>
</p>

<p class="proof">
  令 `t = x^2`,
  <span class="formula">
    `int_(-oo)^oo sin x^2 dx = int_0^oo sin t dt/sqrt t`.
  </span>
  利用
  <span class="formula">
    `2/sqrt pi int_0^oo "e"^(-t u^2) "d"u = 1/sqrt t`,
  </span>
  交换积分次序得
  <span class="formula">
    `int_0^oo sin t dt/sqrt t`
    `= 2/sqrt pi int_0^oo sin t dt int_0^oo "e"^(-t u^2) "d"u`
    `= 2/sqrt pi int_0^oo "d"u int_0^oo "e"^(-t u^2) sin t dt`
    `= 2/sqrt pi int_0^oo ("d"u)/(1+u^4)`
    `= 2/sqrt pi * pi/(2 sqrt 2)`
    `= sqrt(pi / 2)`.
  </span>
  最后, 由于 `t ge t_0 gt 0` 时
  <span class="formula">
    `sin t "e"^(-t u ^2)`
    `le "e"^(-t_0 u^2)`
  </span>
  关于 `t` 一致收敛; `u ge u_0 gt 0` 时
  <span class="formula">
    `sin t "e"^(-t u^2)`
    `le sin t "e"^(-t u_0^2)`
  </span>
  关于 `u` 一致收敛, 所以积分换序是可行的.
</p>

<p class="proof">
  考虑函数 `"e"^("i"z^n)` 在扇形围道 `C = C_1 + C_2 + C_3` 上的积分, 其中
  <span class="formula">
    `C_1: [0, R]`, `quad C_2: z=R"e"^("i" theta), theta in [0, pi/(2n)]`,<br>
    `C_3: z=r"e"^("i"pi//2n), 0 le r le R`.
  </span>
  `R to oo` 时, 我们说明 `C_2` 上的积分趋于零:
  <span class="formula">
    `|"e"^("i"z^n)|`
    `= exp(-R^n sin n theta)`
    `le exp(-R^n (2n)/pi theta)`,
  </span>
  所以
  <span class="formula">
    `|int_(C_2) "e"^("i"z^n) dz|`
    `le int_0^(pi//2n) exp(-R^n (2n)/pi theta) R"d"theta`
    `= pi/(R^(n-1) 2n)(1-"e"^(-R^n))`
    `to 0`.
  </span>
  于是由 Cauchy 积分定理, `I_1 = -I_3`, 即
  <span class="formula">
    `int_0^oo "e"^("i"z^n) dz`
    `= int_0^oo "e"^(-r^n) * "e"^("i"pi//2n) "d"r`,
  </span>
  其中
  <span class="formula">
    `int_0^oo "e"^(-r^n) "d"r`
    `= 1/n int_0^oo "e"^-x x^(1/n-1) dx`
    `= 1/n Gamma(1/n)`.
  </span>
  最后分取实部虚部即得结论.
</p>

<ol class="corollary">
  <li>`int_0^oo x^(-ln x) dx`
      `==^(x="e"^t) int_-oo^oo "e"^(t-t^2) dt`
      `= int_-oo^oo "e"^(-(t-1//2)^2+1//4) dt`
      `= "e"^(1//4) sqrt pi`.
  </li>
  <li>
    `int_0^oo (1-cos x)/x^2 dx`
    `= -(1-cos x)/x |_0^oo + int_0^oo (sin x)/x dx`
    `= pi/2`.<br>
    `int_0^oo (cos a x - cos b x)/x^2 dx`
    `= int_0^oo ((1-cos b x) - (1-cos a x))/x^2 dx`
    `= pi/2(b - a)`.
  </li>
</ol>

<ol class="example">
  <b>Froullani 积分</b>
  [来自 菲赫金哥尔茨]
  设 `a, b gt 0`, `f` 在 `(0, oo)` 上连续,
  <li>若 `f(0)` 处连续, 且 `f(+oo)` 有极限, 则
    <span class="formula">
      `int_0^oo (f(b x) - f(a x))/x dx`
      `= int_a^b (f(oo) - f(0))/x dx`
      `= {:f(x)|_0^oo ln{:b/a:}`.
    </span>
    例如, `int_0^oo ("e"^(-a x) - "e"^(-b x))/x dx`
    `= ln{:b/a:}`.
  </li>
  <li>
    若 `f(+oo)` 没有极限, 但 `int_A^oo f(x)/x dx` 对某个 `A` 收敛, 则
    <span class="formula">
      `int_0^oo (f(b x) - f(a x))/x dx`
      `= -f(0) ln{:b/a:}`.
    </span>
    例如, `int_0^oo (cos a x - cos b x)/x dx`
    `= ln{:b/a:}`.
  </li>
  <li>同理若 `f(0)` 处的连续性被破坏, 但积分 `int_0^B f(x)/x dx` 存在, 则
    <span class="formula">
      `int_0^oo (f(b x) - f(a x))/x dx`
      `= f(oo) ln{:b/a:}`.
    </span>
    这一情形也可通过换元 `x mapsto 1//x` 化为上一情形.
  </li>
</ol>

<ol class="proof">
  <li>先考虑有限积分, 变形得
    <span class="formula">
      `int_delta^Delta (f(b x)-f(a x))/x dx`
      `= int_(b delta)^(b Delta) f(x)/x dx`
      `- int_(a delta)^(a Delta) f(x)/x dx`
      `= int_(b delta)^(a delta) - int_(b Delta)^(a Delta)`.
    </span>
    两个积分各自应用中值定理得
    <span class="formula">
      `f(xi) int_(b delta)^(a delta) dx/x - f(eta) int_(b Delta)^(a Delta) dx/x`
      `= (f(eta)-f(xi)) ln{:b/a:}`.
    </span>
    再令 `delta to 0^+`, `Delta to +oo` 即得结论.
  </li>
  <li>
    和前面方法类似, 但只在 `f` 连续的一端应用中值定理.
    另一端的积分, 由题目条件应该等于零.
  </li>
</ol>

<p class="proof">
  假如 `f` 可微, 交换积分次序得
  <span class="formula">
    `int_0^oo int_a^b f'(x y) dy dx`
    `= int_a^b int_0^oo f'(x y) dx dy`
    `= {:f(x)|_0^oo int_a^b dy/y`.
  </span>
</p>

<p class="example">
  `int_0^1 (x^b - x^a)/(ln x) dx`, `a, b gt 0`.
</p>

<p class="solution">
  交换积分次序, 原式等于
  <span class="formula">
    `int_0^1 int_a^b x^y dy dx`
    `= int_a^b int_0^1 x^y dx dy`
    `= int_a^b dy/(y+1)`
    `= ln{:(b+1)/(a+1):}`.
  </span>
</p>

<h3>杂例</h3>

<p class="example">
	`int_0^1 (ln(1+x))/(1+x^2) dx`.
</p>

<p class="solution">
	令 `I(s) = int_0^1 (ln(1+s x))/(1+x^2) dx`, 积分号下求导,
  <span class="formula">
    `I(1) = int_0^1 I'(s) "d"s`
    `= int_0^1 (int_0^1 x/(1+x^2) dx/(1+s x) dx) "d"s`
    `= int_0^1 ((ln 2)/2 1/(1+s^2) + pi/4 s/(1+s^2)
    - (ln(1+s))/(1+s^2) ) "d"s`
    `= pi/4 ln 2 - I(1)`.
  </span>
  所以 `I(1) = pi/8 ln 2`.
</p>

<p class="solution">
  [来自 群友 ζ(me)=0] 令 `x = tan t`, 原式化为
  <span class="formula">
    `int_0^(pi/4) ln(1+tan t) dt`
    `= int_0^(pi/8) + int_(pi/8)^(pi/4)`
    `= int_0^(pi/8) (ln(1+tan t) + ln(1+tan(pi/4-t))) dt`
    `= int_0^(pi/8) (ln(1+tan t) + ln(2/(1+tan t))) dt`
    `= int_0^(pi/8) ln 2 dt`
    `= pi/8 ln 2`.
  </span>
</p>

<p class="example">
  `int_0^pi ln(2 + cos x) dx`.
</p>

<p class="solution">
  [来自 永远的神 alaros] 考虑
  <span class="formula">
    `I(s) = int_0^pi ln(s + cos x) dx`, `quad s gt 1`.
  </span>
  对参数求导, 利用万能公式积分
  <span class="formula">
    `I'(s)`
    `= int_0^pi dx/(s + cos x)`
    `= cdots = pi/sqrt(s^2-1)`.
  </span>
  利用 Euler 积分 `int_0^(pi/2) cos x dx = -pi ln 2`,
  <span class="formula">
    `I(1) = int_0^pi ln(1+cos x) dx`
    `= int_0^pi ln(2 cos^2{:x/2:}) dx`
    `= -pi ln 2`,
  </span>
  所以
  <span class="formula">
    `I(s) = I(1) + int_1^s I'(t) dt`
    `= -pi ln 2 + pi ln (s + sqrt(s^2-1))`
    `= pi ln {:(s+sqrt(s^2-1))/2:}`.
  </span>
</p>

<p class="solution">
  [来自傻子・疯子・神经病] 考虑
  <span class="formula">
    `J(s) = int_0^pi ln(2 + s cos x) dx`, `quad |s| lt 2`.
  </span>
  求导后使用万能公式得
  <span class="formula">
    `J'(s) = int_0^pi (cos x)/(2 + s cos x) dx`
    `= cdots = pi/s (1 - 2/sqrt(4 - s^2))`.
  </span>
  于是
  <span class="formula">
    `J(s) = J(0) + int_0^s J'(t) dt`
    `= pi ln (1 + sqrt(4-s^2)/2)`.
  </span>
</p>

<p class="solution">
  利用 Poisson 积分
  <span class="formula">
    `f(r) = int_0^pi ln(1 + r^2 + 2 r cos x) dx = 2 pi ln r`, `quad r gt 1`.
  </span>
  我们要让 `1 + r^2` 恰为 `2 r` 的两倍, 于是 `r = 2 + sqrt 3`,
  <span class="formula">
    `int_0^pi ln(2 + cos x) dx`
    `= f(r) - int_0^pi ln (2r) dx`
    `= pi ln{:r^2/(2 r):}`
    `= pi ln(1 + sqrt 3 / 2)`.
  </span>
</p>

<p class="example">
  [武理 叶子昊 bilibili: 努力math]<br/>
  `int_0^(pi/2) (x sin x)/(1+cos^2 x) dx`
  `= int_0^(pi/2) arctan(cos x) dx = pi^2/8 - 1/2 ln^2(1+sqrt2)`.</p>

<p class="proof">
  记 `I(s) = int_0^(pi/2) arctan(s cos x) dx`, 则
  <span class="formula align">
    `I(1) = int_0^1 I'(s) "d"s`<br>
    `= int_0^1 int_0^(pi/2) cos x/(1 + s^2 cos^2 x) dx "d"s`<br>
    `= int_0^1 int_0^1 dt/(1 + s^2 - s^2 t^2) "d"s`<br>
    `= int_0^1 1/(2s^2 sqrt(1+s^-2)) ln{:(sqrt(1+s^-2) + 1)/(sqrt(1+s^-2)
    - 1):} "d"s`<br>
    `= int_0^1 ("arsh" s)/(s^2 sqrt(1+s^-2)) "d"s`<br>
    `= -int_0^1 ("arsh" s)/sqrt(1+s^-2) "d"(1/s)`<br>
    `= -["arsh" s * "arsh" 1/s]_0^1 + int_0^1 ("arsh"1/s)/sqrt(1+s^2) "d"s`<br>
    `= -ln^2(1+sqrt 2) + int_1^oo ("arsh"s)/(s^2 sqrt(1+s^-2)) "d"s`<br>
    `= -ln^2(1+sqrt 2) + I(+oo) - I(1)`<br>
    `= -ln^2(1+sqrt 2) + pi^2/4 - I(1)`,
  </span>
  整理即得结论.
</p>

<ol class="example">
  [来自 <a href="https://math.stackexchange.com/questions/1943695/prove-int-0-infty-frac-ln-xx21x31-dx-frac37432-pi2-w" target="_blank">stack exchange</a>]
  <li>对任意 `z in CC\\(-oo, 0]`, 证明
    <span class="formula">
      `I(z) := int_0^oo ((ln x)/(x + z) - (ln x)/(x + 1)) dx = -1/2 ln^2 z`.
    </span>
    等号右边的对数取辐角位于 `(-pi, pi)` 的主值.
  </li>
  <li>利用 1. 的结论求积分 `int_0^oo (ln x)/(x^3 + 1) dx = -(2pi^2)/27`.</li>
  <li>完全类似的方法还可求出 `int_0^oo (ln x)/((x^3+1)(x^2+1)) dx = -(37pi^2)/432`.</li>
</ol>

<ol class="solution">
  <li>对参数 `z` 求导,
    <span class="formula">
      `I'(z)`
      `= - int_0^oo (ln x)/(x+z)^2 dx`.
    </span>
    先求
    <span class="formula">
      `-int_epsi^oo (ln x)/(x+z)^2 dx`
      `= -(ln epsi)/(epsi+z) - int_epsi^oo dx/(x(x+z))`
      `= -(ln epsi)/(epsi+z) + 1/z ln epsi - 1/z ln(epsi+z)`,
    </span>
    再令 `epsi to 0` 得 `I'(z) = -1/z ln z`.
    又 `I(1) = 0`, 所以 `I(z) = int_1^z I'(t) dt = -1/2 ln^2 z`.
  </li>
  <li>
    作部分分式分解
    <span class="formula">
      `1/(x^3+1) = (1/3)/(x+1) - (1/6(1 + "i"sqrt 3))/(x - "e"^(pi"i"//3)) - (1/6(1 - "i"sqrt 3))/(x - "e"^(-pi"i"//3))`.
    </span>
    使用 1. 的结论,
    <span class="formula">
      `int_0^oo (ln x)/(x^3 + 1) dx`
      `= 1/6(1+"i"sqrt 3) I(-"e"^(pi"i"//3)) - 1/6(1-"i"sqrt 3) I(-"e"^(-pi"i"//3))`
      `= 1/6(1+"i"sqrt 3) I("e"^(-2pi"i"//3)) - 1/6(1-"i"sqrt 3) I("e"^(2pi"i"//3))`
      `= -(2pi^2)/27`.
    </span>
    其中 `(ln x)/(x+1)` 的积分恰好抵消.
  </li>
</ol>

<script src="../../js/note.js?type=math"></script>
</body>
</html>
